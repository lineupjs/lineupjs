/*! LineUpJS - v0.5.0 - 2016
* https://github.com/Caleydo/lineup.js
* Copyright (c) 2016 Caleydo Team; Licensed BSD-3-Clause*/
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("d3")):"function"==typeof define&&define.amd?define(["d3"],e):"object"==typeof exports?exports.LineUpJS=e(require("d3")):t.LineUpJS=e(t.d3)}(this,function(t){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){n(1),t.exports=n(3)},function(t,e){},,function(t,e,n){"use strict";function r(t){var e=h.scale.category10().range().slice();return t.forEach(function(t){switch(t.type){case"number":t.color=e.shift()}}),t}function i(t,e,n){return void 0===n&&(n={}),new l.LocalDataProvider(t,e,n)}function o(t,e,n){return void 0===n&&(n={}),new f(e,t,n)}var a=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},s=n(4),l=n(7),c=n(8),u=n(9),p=n(6),d=n(10),h=n(5);e.model=s,e.provider=l,e.renderer=c,e.ui=u,e.utils=p,e.ui_dialogs=d;var f=function(t){function n(r,i,o){var a=this;void 0===o&&(o={}),t.call(this),this.data=i,this.config={idPrefix:Math.random().toString(36).slice(-8).substr(0,3),header:{headerHeight:20,headerHistogramHeight:40,autoRotateLabels:!1,rotationHeight:50,rotationDegree:-20,rankingButtons:u.dummyRankingButtonHook,linkTemplates:[]},htmlLayout:{},renderingOptions:{stacked:!0,animation:!0,histograms:!1,meanLine:!1},body:{renderer:"svg",rowHeight:17,rowPadding:.2,rowBarPadding:1,visibleRowsOnly:!0,backupScrollRows:4,animationDuration:1e3,freezeCols:0,rowActions:[]},svgLayout:{},manipulative:!0,pool:!1,renderers:c.renderers()},this.body=null,this.header=null,this.pools=[],this.contentScroller=null,this.isUpdateInitialized=!1,this.$container=r instanceof h.selection?r:h.select(r),this.$container=this.$container.append("div").classed("lu",!0),this.config.svgLayout=this.config.body,this.config.htmlLayout=this.config.header,e.utils.merge(this.config,o),this.data.on("selectionChanged.main",this.triggerSelection.bind(this)),this.header=new u.HeaderRenderer(i,this.node,{manipulative:this.config.manipulative,headerHeight:this.config.header.headerHeight,headerHistogramHeight:this.config.header.headerHistogramHeight,histograms:this.config.renderingOptions.histograms,autoRotateLabels:this.config.header.autoRotateLabels,rotationHeight:this.config.header.rotationHeight,rotationDegree:this.config.header.rotationDegree,freezeCols:this.config.body.freezeCols,rankingButtons:this.config.header.rankingButtons,linkTemplates:this.config.header.linkTemplates}),this.body=new("svg"===this.config.body.renderer?u.BodyRenderer:u.BodyCanvasRenderer)(i,this.node,this.slice.bind(this),{rowHeight:this.config.body.rowHeight,rowPadding:this.config.body.rowPadding,rowBarPadding:this.config.body.rowBarPadding,animationDuration:this.config.body.animationDuration,meanLine:this.config.renderingOptions.meanLine,animation:this.config.renderingOptions.animation,stacked:this.config.renderingOptions.stacked,actions:this.config.body.rowActions,idPrefix:this.config.idPrefix,freezeCols:this.config.body.freezeCols,renderers:this.config.renderers}),this.body.histCache=this.header.sharedHistCache,this.forward(this.body,n.EVENT_HOVER_CHANGED),this.config.pool&&this.config.manipulative&&this.addPool(new u.PoolRenderer(i,this.node,this.config)),this.config.body.visibleRowsOnly&&(this.contentScroller=new p.ContentScroller(this.$container.node(),this.body.node,{backupRows:this.config.body.backupScrollRows,rowHeight:this.config.body.rowHeight,topShift:function(){return a.header.currentHeight()}}),this.contentScroller.on("scroll",function(t,e){a.header.$node.style("transform","translate(0px,"+t+"px)"),a.config.body.freezeCols>0&&(a.header.updateFreeze(e),a.body.updateFreeze(e))}),this.contentScroller.on("redraw",this.body.update.bind(this.body)))}return a(n,t),n.prototype.createEventList=function(){return t.prototype.createEventList.call(this).concat([n.EVENT_HOVER_CHANGED,n.EVENT_SELECTION_CHANGED,n.EVENT_MULTISELECTION_CHANGED,n.EVENT_UPDATE_START,n.EVENT_UPDATE_FINISHED])},n.prototype.addPool=function(t,e){return void 0===e&&(e=this.config),t instanceof u.PoolRenderer?this.pools.push(t):this.pools.push(new u.PoolRenderer(this.data,t,e)),this.pools[this.pools.length-1]},Object.defineProperty(n.prototype,"node",{get:function(){return this.$container.node()},enumerable:!0,configurable:!0}),n.prototype.slice=function(t,e,n){return this.contentScroller?this.contentScroller.select(t,e,n):{from:t,to:e}},n.prototype.destroy=function(){this.pools.forEach(function(t){return t.remove()}),this.$container.remove(),this.contentScroller&&this.contentScroller.destroy()},n.prototype.sortBy=function(t,e){void 0===e&&(e=!1);var n=this.data.find(t);return n&&n.sortByMe(e),null!==n},n.prototype.dump=function(){return this.data.dump()},n.prototype.changeDataStorage=function(t,e){this.data&&this.data.on("selectionChanged.main",null),this.data=t,e&&this.data.restore(e),this.data.on("selectionChanged.main",this.triggerSelection.bind(this)),this.header.changeDataStorage(t),this.body.changeDataStorage(t),this.pools.forEach(function(e){return e.changeDataStorage(t)}),this.update()},n.prototype.triggerSelection=function(t){this.fire(n.EVENT_SELECTION_CHANGED,t.length>0?t[0]:-1),this.fire(n.EVENT_MULTISELECTION_CHANGED,t)},n.prototype.restore=function(t){this.changeDataStorage(this.data,t)},n.prototype.update=function(){var t=this,e=this.isUpdateInitialized?1:3;this.isUpdateInitialized=!0,this.fire(n.EVENT_UPDATE_START),this.header.update(),this.body.update(),this.pools.forEach(function(t){return t.update()}),this.body.on("renderFinished",function(){e-=1,0===e&&t.fire(n.EVENT_UPDATE_FINISHED)})},n.prototype.changeRenderingOption=function(t,e){this.config.renderingOptions[t]=e,"animation"!==t&&"stacked"!==t||(this.body.setOption(t,e),this.body.update())},n.EVENT_HOVER_CHANGED="hoverChanged",n.EVENT_SELECTION_CHANGED="selectionChanged",n.EVENT_MULTISELECTION_CHANGED="multiSelectionChanged",n.EVENT_UPDATE_START="updateStart",n.EVENT_UPDATE_FINISHED="updateFinished",n}(p.AEventDispatcher);e.LineUp=f,e.deriveColors=r,e.createLocalStorage=i,e.create=o},function(t,e,n){"use strict";function r(t){return t.replace(/[\s!#$%&'\(\)\*\+,\.\/:;<=>\?@\[\\\]\^`\{\|}~]/g,"_")}function i(t,e){return t===e||isNaN(t)&&isNaN(e)?0:t-e}function o(t){return t instanceof v&&"function"==typeof t.getNumber||!(t instanceof v)&&null!=t.type.match(/(number|stack|ordinal)/)}function a(t){return t instanceof v&&"function"==typeof t.getCategories||!(t instanceof v)&&null!=t.type.match(/(categorical|ordinal)/)}function s(t){switch(void 0===t&&(t="linear"),t){case"log":return m.scale.log().clamp(!0);case"sqrt":return m.scale.sqrt().clamp(!0);case"pow1.1":return m.scale.pow().exponent(1.1).clamp(!0);case"pow2":return m.scale.pow().exponent(2).clamp(!0);case"pow3":return m.scale.pow().exponent(3).clamp(!0);default:return m.scale.linear().clamp(!0)}}function l(t,e){return t.length===e.length&&t.every(function(t,n){return t===e[n]})}function c(t,e){return"log"===e&&0===t[0]&&(t[0]=1e-7),t}function u(t){if("script"===t.type){var e=new x;return e.restore(t),e}var n=new k;return n.restore(t),n}function p(t,e){var n=null!=t?t.length:0,r=null!=e?e.length:0;return n===r&&(0===n||t.every(function(t,n){return t===e[n]}))}function d(t,e){void 0===e&&(e={});var n=function(t){function e(e,n){t.call(this,e,n),"function"==typeof this.init&&this.init.apply(this,[].slice.apply(arguments))}return g(e,t),e}(b);return n.prototype.toString=function(){return t},n.prototype=y.merge(n.prototype,e),n}function h(t){return void 0===t&&(t="actions"),{type:"actions",label:t}}function f(){return{number:w,string:E,link:_,stack:D,rank:M,"boolean":L,categorical:P,ordinal:F,actions:C,annotate:R,selection:S,max:V,min:A,mean:A,script:N}}var g=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},m=n(5),y=n(6),v=function(t){function e(n,i){t.call(this),this.desc=i,this.width=100,this.parent=null,this.compressed=!1,this.id=r(n),this.label=this.desc.label||this.id,this.cssClass=this.desc.cssClass||"",this.color=this.desc.color||(""!==this.cssClass?null:e.DEFAULT_COLOR)}return g(e,t),Object.defineProperty(e.prototype,"headerCssClass",{get:function(){return this.desc.type},enumerable:!0,configurable:!0}),e.prototype.assignNewId=function(t){this.id=r(t())},e.prototype.init=function(t){return Promise.resolve(!0)},Object.defineProperty(e.prototype,"fqid",{get:function(){return this.parent?this.parent.fqid+"_"+this.id:this.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fqpath",{get:function(){return this.parent?this.parent.fqpath+"@"+this.parent.indexOf(this):""},enumerable:!0,configurable:!0}),e.prototype.createEventList=function(){return t.prototype.createEventList.call(this).concat(["widthChanged","filterChanged","labelChanged","metaDataChanged","compressChanged","addColumn","removeColumn","dirty","dirtyHeader","dirtyValues"])},e.prototype.getWidth=function(){return this.width},e.prototype.isHidden=function(){return this.width<=0},e.prototype.setCompressed=function(t){this.compressed!==t&&this.fire(["compressChanged","dirtyHeader","dirtyValues","dirty"],this.compressed,this.compressed=t)},e.prototype.getCompressed=function(){return this.compressed},e.prototype.flatten=function(t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=0);var o=this.compressed?e.COMPRESSED_WIDTH:this.getWidth();return t.push({col:this,offset:n,width:o}),o},e.prototype.setWidth=function(t){this.width!==t&&this.fire(["widthChanged","dirtyHeader","dirtyValues","dirty"],this.width,this.width=t)},e.prototype.setWidthImpl=function(t){this.width=t},e.prototype.setMetaData=function(t){if(t.label!==this.label||this.color!==t.color){var e=this.color===t.color?["labelChanged","metaDataChanged","dirtyHeader","dirty"]:["labelChanged","metaDataChanged","dirtyHeader","dirtyValues","dirty"];this.fire(e,this.getMetaData(),{label:this.label=t.label,color:this.color=t.color})}},e.prototype.getMetaData=function(){return{label:this.label,color:this.color}},e.prototype.sortByMe=function(t){void 0===t&&(t=!1);var e=this.findMyRanker();return!!e&&e.sortBy(this,t)},e.prototype.toggleMySorting=function(){var t=this.findMyRanker();return!!t&&t.toggleSorting(this)},e.prototype.removeMe=function(){return!!this.parent&&this.parent.remove(this)},e.prototype.insertAfterMe=function(t){return!!this.parent&&null!=this.parent.insertAfter(t,this)},e.prototype.findMyRanker=function(){return this.parent?this.parent.findMyRanker():null},e.prototype.dump=function(t){var n={id:this.id,desc:t(this.desc),width:this.width,compressed:this.compressed};return this.label!==(this.desc.label||this.id)&&(n.label=this.label),this.color!==(this.desc.color||e.DEFAULT_COLOR)&&this.color&&(n.color=this.color),n},e.prototype.restore=function(t,e){this.width=t.width||this.width,this.label=t.label||this.label,this.color=t.color||this.color,this.compressed=t.compressed===!0},e.prototype.getLabel=function(t){return""+this.getValue(t)},e.prototype.getValue=function(t){return""},e.prototype.compare=function(t,e){return 0},e.prototype.isFiltered=function(){return!1},e.prototype.filter=function(t){return null!==t},e.DEFAULT_COLOR="#C1C1C1",e.FLAT_ALL_COLUMNS=-1,e.COMPRESSED_WIDTH=16,e}(y.AEventDispatcher);e.Column=v;var b=function(t){function e(e,n){t.call(this,e,n),this.accessor=n.accessor||function(){return null}}return g(e,t),e.prototype.getLabel=function(t){return""+this.getValue(t)},e.prototype.getValue=function(t){return this.accessor(t,this.id,this.desc,this.findMyRanker())},e.prototype.compare=function(t,e){return 0},e}(v);e.ValueColumn=b;var C=function(t){function e(e,n){t.call(this,e,n)}return g(e,t),e.prototype.getLabel=function(t){return""},e.prototype.getValue=function(t){return""},e.prototype.compare=function(t,e){return 0},e}(v);e.DummyColumn=C,e.isNumberColumn=o,e.isCategoricalColumn=a;var k=function(){function t(t,e,n){void 0===t&&(t=[0,1]),void 0===e&&(e="linear"),void 0===n&&(n=[0,1]),this.type=e,this.s=s(e).domain(c(t,this.type)).range(n)}return Object.defineProperty(t.prototype,"domain",{get:function(){return this.s.domain()},set:function(t){this.s.domain(c(t,this.type))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"range",{get:function(){return this.s.range()},set:function(t){this.s.range(t)},enumerable:!0,configurable:!0}),t.prototype.apply=function(t){return this.s(t)},Object.defineProperty(t.prototype,"scaleType",{get:function(){return this.type},enumerable:!0,configurable:!0}),t.prototype.dump=function(){return{type:this.type,domain:this.domain,range:this.range}},t.prototype.eq=function(e){if(!(e instanceof t))return!1;var n=e;return n.type===this.type&&l(this.domain,n.domain)&&l(this.range,n.range)},t.prototype.restore=function(t){this.type=t.type,this.s=s(t.type).domain(t.domain).range(t.range)},t.prototype.clone=function(){return new t(this.domain,this.type,this.range)},t}();e.ScaleMappingFunction=k;var x=function(){function t(t,e){void 0===t&&(t=[0,1]),void 0===e&&(e="return this.linear(value,this.value_min,this.value_max);"),this.domain_=t,this.code_=e,this.f=new Function("value",e)}return Object.defineProperty(t.prototype,"domain",{get:function(){return this.domain_},set:function(t){this.domain_=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"code",{get:function(){return this.code_},set:function(t){this.code_!==t&&(this.code_=t,this.f=new Function("value",t))},enumerable:!0,configurable:!0}),t.prototype.apply=function(t){var e=this.domain_[0],n=this.domain_[this.domain_.length-1],r=this.f.call({value_min:e,value_max:n,value_range:n-e,value_domain:this.domain_.slice(),linear:function(t,e,n){return(t-e)/(n-e)}},t);return"number"==typeof r?Math.max(Math.min(r,1),0):NaN},t.prototype.dump=function(){return{type:"script",code:this.code}},t.prototype.eq=function(e){if(!(e instanceof t))return!1;var n=e;return n.code===this.code},t.prototype.restore=function(t){this.code=t.code},t.prototype.clone=function(){return new t(this.domain,this.code)},t}();e.ScriptMappingFunction=x,e.createMappingFunction=u;var w=function(t){function e(e,n){t.call(this,e,n),this.missingValue=0,this.currentFilter={min:-(1/0),max:1/0},this.numberFormat=m.format(".3n"),n.map?this.mapping=u(n.map):n.domain&&(this.mapping=new k(n.domain,"linear",n.range||[0,1])),this.original=this.mapping.clone(),n.numberFormat&&(this.numberFormat=m.format(n.numberFormat))}return g(e,t),e.prototype.init=function(t){var e=this,n=this.mapping.domain;return isNaN(n[0])||isNaN(n[1])?t(this.desc).then(function(t){return e.mapping.domain=[t.min,t.max],e.original.domain=[t.min,t.max],!0}):Promise.resolve(!0)},e.prototype.dump=function(e){var n=t.prototype.dump.call(this,e);return n.map=this.mapping.dump(),n.filter=this.currentFilter,n.missingValue=this.missingValue,n},e.prototype.restore=function(e,n){t.prototype.restore.call(this,e,n),e.map?this.mapping=u(e.map):e.domain&&(this.mapping=new k(e.domain,"linear",e.range||[0,1])),e.currentFilter&&(this.currentFilter=e.currentFilter),e.missingValue&&(this.missingValue=e.missingValue),e.numberFormat&&(this.numberFormat=m.format(e.numberFormat))},e.prototype.createEventList=function(){return t.prototype.createEventList.call(this).concat(["mappingChanged"])},e.prototype.getLabel=function(e){var n=t.prototype.getValue.call(this,e);return""+("number"==typeof n?this.numberFormat(n):n)},e.prototype.getRawValue=function(e){var n=t.prototype.getValue.call(this,e);return"undefined"==typeof n||null==n||isNaN(n)||""===n||"NA"===n||"string"==typeof n&&"na"===n.toLowerCase()?this.missingValue:+n},e.prototype.getValue=function(t){var e=this.getRawValue(t);return isNaN(e)?e:this.mapping.apply(e)},e.prototype.getNumber=function(t){return this.getValue(t)},e.prototype.compare=function(t,e){return i(this.getValue(t),this.getValue(e))},e.prototype.getOriginalMapping=function(){return this.original.clone()},e.prototype.getMapping=function(){return this.mapping.clone()},e.prototype.setMapping=function(t){this.mapping.eq(t)||this.fire(["mappingChanged","dirtyValues","dirty"],this.mapping.clone(),this.mapping=t)},e.prototype.isFiltered=function(){return isFinite(this.currentFilter.min)||isFinite(this.currentFilter.max)},Object.defineProperty(e.prototype,"filterMin",{get:function(){return this.currentFilter.min},set:function(t){var e={min:this.currentFilter.min,max:this.currentFilter.max};this.currentFilter.min=isNaN(t)?-(1/0):t,this.fire(["filterChanged","dirtyValues","dirty"],e,this.currentFilter)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filterMax",{get:function(){return this.currentFilter.max},set:function(t){var e={min:this.currentFilter.min,max:this.currentFilter.max};this.currentFilter.max=isNaN(t)?1/0:t,this.fire(["filterChanged","dirtyValues","dirty"],e,this.currentFilter)},enumerable:!0,configurable:!0}),e.prototype.getFilter=function(){return{min:this.currentFilter.min,max:this.currentFilter.max}},e.prototype.setFilter=function(t){if(void 0===t&&(t={min:-(1/0),max:+(1/0)}),this.currentFilter.min!==t.min||this.currentFilter.max!==t.max){var e=this.getFilter();this.currentFilter.min=isNaN(t.min)?-(1/0):t.min,this.currentFilter.max=isNaN(t.max)?1/0:t.max,this.fire(["filterChanged","dirtyValues","dirty"],e,this.currentFilter)}},e.prototype.filter=function(t){if(!this.isFiltered())return!0;var e=this.getRawValue(t);return!!isNaN(e)||!(isFinite(this.currentFilter.min)&&e<this.currentFilter.min||isFinite(this.currentFilter.max)&&e<this.currentFilter.max)},e}(b);e.NumberColumn=w;var E=function(t){function e(e,n){t.call(this,e,n),this.currentFilter=null,this._alignment="left",this.setWidthImpl(200),this._alignment=n.alignment||"left"}return g(e,t),Object.defineProperty(e.prototype,"alignment",{get:function(){return this._alignment},enumerable:!0,configurable:!0}),e.prototype.getValue=function(e){var n=t.prototype.getValue.call(this,e);return"undefined"==typeof n||null==n?"":n},e.prototype.dump=function(e){var n=t.prototype.dump.call(this,e);return this.currentFilter instanceof RegExp?n.filter="REGEX:"+this.currentFilter.source:n.filter=this.currentFilter,n.alignment=this.alignment,n},e.prototype.restore=function(e,n){t.prototype.restore.call(this,e,n),e.filter&&"REGEX:"===e.filter.slice(0,6)?this.currentFilter=new RegExp(e.filter.slice(6)):this.currentFilter=e.filter||null,this._alignment=e.alignment||this._alignment},e.prototype.isFiltered=function(){return null!=this.currentFilter},e.prototype.filter=function(t){if(!this.isFiltered())return!0;var e=this.getLabel(t),n=this.currentFilter;return"string"==typeof n&&n.length>0?e&&e.toLowerCase().indexOf(n.toLowerCase())>=0:!(n instanceof RegExp)||e&&n.test(e)},e.prototype.getFilter=function(){return this.currentFilter},e.prototype.setFilter=function(t){""===t&&(t=null),this.currentFilter!==t&&this.fire(["filterChanged","dirtyValues","dirty"],this.currentFilter,this.currentFilter=t)},e.prototype.compare=function(t,e){return""===this.getValue(t)?1:""===this.getValue(e)?-1:this.getValue(t)===this.getValue(e)?0:this.getValue(t)<this.getValue(e)?-1:1},e}(b);e.StringColumn=E;var _=function(t){function e(e,n){t.call(this,e,n),this.link=null,this.link=n.link}return g(e,t),Object.defineProperty(e.prototype,"headerCssClass",{get:function(){return null==this.link?"link":"link link_pattern"},enumerable:!0,configurable:!0}),e.prototype.createEventList=function(){return t.prototype.createEventList.call(this).concat(["linkChanged"])},e.prototype.setLink=function(t){t!=this.link&&this.fire(["linkChanged","dirtyHeader","dirtyValues","dirty"],this.link,this.link=t)},e.prototype.getLink=function(){return this.link||""},e.prototype.dump=function(e){var n=t.prototype.dump.call(this,e);return this.link!=this.desc.link&&(n.link=this.link),n},e.prototype.restore=function(e,n){t.prototype.restore.call(this,e,n),e.link&&(this.link=e.link)},e.prototype.getLabel=function(e){var n=t.prototype.getValue.call(this,e);return n.alt?n.alt:""+n},e.prototype.isLink=function(e){if(this.link)return!0;var n=t.prototype.getValue.call(this,e);return null!=n.href},e.prototype.getValue=function(e){var n=t.prototype.getValue.call(this,e);return n.href?n.href:this.link?this.link.replace(/\$1/g,n):n},e}(E);e.LinkColumn=_;var R=function(t){function e(e,n){t.call(this,e,n),this.annotations=m.map()}return g(e,t),e.prototype.createEventList=function(){return t.prototype.createEventList.call(this).concat(["valueChanged"])},e.prototype.getValue=function(e){var n=String(e._index);return this.annotations.has(n)?this.annotations.get(n):t.prototype.getValue.call(this,e)},e.prototype.dump=function(e){var n=t.prototype.dump.call(this,e);return n.annotations={},this.annotations.forEach(function(t,e){n.annotations[t]=e}),n},e.prototype.restore=function(e,n){var r=this;t.prototype.restore.call(this,e,n),e.annotations&&Object.keys(e.annotations).forEach(function(t){r.annotations.set(t,e.annotations[t])})},e.prototype.setValue=function(t,e){var n=this.getValue(t);return n===e||(""===e||null==e?this.annotations.remove(String(t._index)):this.annotations.set(String(t._index),e),this.fire(["valueChanged","dirtyValues","dirty"],t._index,n,e),!0)},e}(E);e.AnnotateColumn=R;var S=function(t){function e(e,n){t.call(this,e,n),this.setCompressed(!0)}return g(e,t),e.desc=function(t){return void 0===t&&(t="S"),{type:"selection",label:t}},e.prototype.createEventList=function(){return t.prototype.createEventList.call(this).concat(["select"])},e.prototype.setValue=function(t,e){var n=this.getValue(t);return n===e||this.setImpl(t,e)},e.prototype.setImpl=function(t,e){return this.desc.setter&&this.desc.setter(t,e),this.fire("select",t,e),!0},e.prototype.toggleValue=function(t){var e=this.getValue(t);return this.setImpl(t,!e),!e},e.prototype.compare=function(t,e){return m.ascending(this.getValue(t),this.getValue(e))},e}(b);e.SelectionColumn=S;var L=function(t){function e(e,n){t.call(this,e,n),this.currentFilter=null,this.trueMarker="X",this.falseMarker="",this.setWidthImpl(30),this.trueMarker=n.trueMarker||this.trueMarker,this.falseMarker=n.falseMarker||this.falseMarker}return g(e,t),e.prototype.getValue=function(e){var n=t.prototype.getValue.call(this,e);return"undefined"!=typeof n&&null!=n&&(n===!0||"true"===n||"yes"===n||"x"===n)},e.prototype.getLabel=function(t){var e=this.getValue(t);return e?this.trueMarker:this.falseMarker},e.prototype.dump=function(e){var n=t.prototype.dump.call(this,e);return null!==this.currentFilter&&(n.filter=this.currentFilter),n},e.prototype.restore=function(e,n){t.prototype.restore.call(this,e,n),"undefined"!=typeof e.filter&&(this.currentFilter=e.filter)},e.prototype.isFiltered=function(){return null!==this.currentFilter},e.prototype.filter=function(t){if(!this.isFiltered())return!0;var e=this.getValue(t);return e===this.currentFilter},e.prototype.getFilter=function(){return this.currentFilter},e.prototype.setFilter=function(t){this.currentFilter!==t&&this.fire(["filterChanged","dirtyValues","dirty"],this.currentFilter,this.currentFilter=t)},e.prototype.compare=function(t,e){return m.ascending(this.getValue(t),this.getValue(e))},e}(b);e.BooleanColumn=L;var P=function(t){function e(e,n){t.call(this,e,n),this.colors=m.scale.category10(),this.catLabels=m.map(),this.currentFilter=null,this.separator=";",this.separator=n.separator||this.separator,this.initCategories(n)}return g(e,t),e.prototype.initCategories=function(t){if(t.categories){var e=[],n=this.colors.range(),r=m.map();t.categories.forEach(function(t,i){"string"==typeof t?e.push(t):(e.push(t.name),t.label&&r.set(t.name,t.label),n[i]=t.color)}),this.catLabels=r,this.colors.domain(e).range(n)}},Object.defineProperty(e.prototype,"categories",{get:function(){return this.colors.domain()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"categoryColors",{get:function(){return this.colors.range()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"categoryLabels",{get:function(){var t=this;return null===this.catLabels||this.catLabels.empty()?this.categories:this.categories.map(function(e){return t.catLabels.has(e)?t.catLabels.get(e):e})},enumerable:!0,configurable:!0}),e.prototype.colorOf=function(t){return this.colors(t)},e.prototype.getLabel=function(t){return null===this.catLabels||this.catLabels.empty()?""+E.prototype.getValue.call(this,t):this.getLabels(t).join(this.separator)},e.prototype.getFirstLabel=function(t){var e=this.getLabels(t);return e.length>0?e[0]:null},e.prototype.getLabels=function(t){var e=this,n=E.prototype.getValue.call(this,t),r=n.split(this.separator),i=function(t){return null===e.catLabels||e.catLabels.empty()?t:t.map(function(t){return e.catLabels.has(t)?e.catLabels.get(t):t})};return i(r)},e.prototype.getValue=function(t){var e=this.getValues(t);return e.length>0?e[0]:null},e.prototype.getValues=function(t){var e=E.prototype.getValue.call(this,t),n=e.split(this.separator);return n},e.prototype.getCategories=function(t){return this.getValues(t)},e.prototype.getColor=function(t){var e=this.getValue(t);return null===e||""===e?null:this.colors(e)},e.prototype.getColors=function(t){return this.getValues(t).map(this.colors)},e.prototype.dump=function(e){var n=t.prototype.dump.call(this,e);return n.filter=this.currentFilter,n.colors={domain:this.colors.domain(),range:this.colors.range(),separator:this.separator},n},e.prototype.restore=function(e,n){t.prototype.restore.call(this,e,n),this.currentFilter=e.filter||null,e.colors&&this.colors.domain(e.colors.domain).range(e.colors.range),this.separator=e.separator||this.separator},e.prototype.isFiltered=function(){return null!=this.currentFilter},e.prototype.filter=function(t){if(!this.isFiltered())return!0;var e=this.getValues(t),n=this.currentFilter;return e.every(function(t){return Array.isArray(n)&&n.length>0?n.indexOf(t)>=0:"string"==typeof n&&n.length>0?t&&t.toLowerCase().indexOf(n.toLowerCase())>=0:!(n instanceof RegExp)||null!=t&&t.match(n).length>0})},e.prototype.getFilter=function(){return this.currentFilter},e.prototype.setFilter=function(t){p(this.currentFilter,t)||this.fire(["filterChanged","dirtyValues","dirty"],this.currentFilter,this.currentFilter=t)},e.prototype.compare=function(t,e){for(var n=this.getValues(t),r=this.getValues(e),i=0;i<Math.min(n.length,r.length);++i){var o=m.ascending(n[i],r[i]);if(0!==o)return o}return n.length-r.length},e}(b);e.CategoricalColumn=P;var F=function(t){function e(e,n){if(t.call(this,e,n),this.colors=m.scale.category10(),this.catLabels=m.map(),this.scale=m.scale.ordinal().rangeRoundPoints([0,1]),this.currentFilter=null,this.separator=";",this.combiner=m.max,this.separator=n.separator||this.separator,P.prototype.initCategories.call(this,n),this.scale.domain(this.colors.domain()),n.categories){var r=[];n.categories.forEach(function(t){"string"!=typeof t&&"number"==typeof t.value?r.push(t.value):r.push(.5)}),this.scale.range(r)}}return g(e,t),e.prototype.createEventList=function(){return t.prototype.createEventList.call(this).concat(["mappingChanged"])},Object.defineProperty(e.prototype,"categories",{get:function(){return this.colors.domain()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"categoryColors",{get:function(){return this.colors.range()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"categoryLabels",{get:function(){var t=this;return null===this.catLabels||this.catLabels.empty()?this.categories:this.categories.map(function(e){return t.catLabels.has(e)?t.catLabels.get(e):e})},enumerable:!0,configurable:!0}),e.prototype.colorOf=function(t){return this.colors(t)},e.prototype.getLabel=function(t){return P.prototype.getLabel.call(this,t)},e.prototype.getFirstLabel=function(t){return P.prototype.getFirstLabel.call(this,t)},e.prototype.getLabels=function(t){return P.prototype.getLabels.call(this,t)},e.prototype.getValue=function(t){var e=this.getValues(t);return e.length>0?this.combiner(e):0},e.prototype.getValues=function(t){var e=P.prototype.getValues.call(this,t);return e.map(this.scale)},e.prototype.getCategories=function(t){return P.prototype.getValues.call(this,t)},e.prototype.getNumber=function(t){return this.getValue(t)},e.prototype.getColor=function(t){var e=this.getValues(t),n=this.getColors(t);return this.combiner===m.max?n.slice(1).reduce(function(t,n,r){return e[r+1]>t.v?{c:n,v:e[r+1]}:t},{c:n[0],v:e[0]}).c:this.combiner===m.min?n.slice(1).reduce(function(t,n,r){return e[r+1]<t.v?{c:n,v:e[r+1]}:t},{c:n[0],v:e[0]}).c:n[0]||null},e.prototype.getColors=function(t){return P.prototype.getColors.call(this,t)},e.prototype.dump=function(t){var e=P.prototype.dump.call(this,t);return e.scale={domain:this.scale.domain(),range:this.scale.range(),separator:this.separator},e},e.prototype.restore=function(t,e){P.prototype.restore.call(this,t,e),t.scale&&this.scale.domain(t.scale.domain).range(t.scale.range),this.separator=t.separator||this.separator},e.prototype.getScale=function(){return{domain:this.scale.domain(),range:this.scale.range()}},e.prototype.getMapping=function(){return this.scale.range().slice()},e.prototype.setMapping=function(t){var e=this.getScale();this.scale.range(t),this.fire(["mappingChanged","dirtyValues","dirty"],e,this.getScale())},e.prototype.isFiltered=function(){return null!=this.currentFilter},e.prototype.filter=function(t){return P.prototype.filter.call(this,t)},e.prototype.getFilter=function(){return this.currentFilter},e.prototype.setFilter=function(t){this.currentFilter!==t&&this.fire(["filterChanged","dirtyValues","dirty"],this.currentFilter,this.currentFilter=t)},e.prototype.compare=function(t,e){return w.prototype.compare.call(this,t,e)},e}(b);e.CategoricalNumberColumn=F;var O=function(t){function e(e,n){t.call(this,e,n),this.missingValue=0,this._children=[],this.numberFormat=m.format(".3n"),n.numberFormat&&(this.numberFormat=m.format(n.numberFormat))}return g(e,t),e.prototype.assignNewId=function(e){t.prototype.assignNewId.call(this,e),this._children.forEach(function(t){return t.assignNewId(e)})},Object.defineProperty(e.prototype,"children",{get:function(){return this._children.slice()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._children.length},enumerable:!0,configurable:!0}),e.prototype.flatten=function(t,e,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var i=null;if(0===n||n<=v.FLAT_ALL_COLUMNS){var o=this.getCompressed()?v.COMPRESSED_WIDTH:this.getWidth();if(t.push(i={col:this,offset:e,width:o}),0===n)return o}return this._children.forEach(function(i){(!i.isHidden()||n<=v.FLAT_ALL_COLUMNS)&&i.flatten(t,e,n-1,r)}),o},e.prototype.dump=function(e){var n=t.prototype.dump.call(this,e);return n.children=this._children.map(function(t){return t.dump(e)}),n.missingValue=this.missingValue,n},e.prototype.restore=function(e,n){var r=this;e.missingValue&&(this.missingValue=e.missingValue),e.numberFormat&&(this.numberFormat=m.format(e.numberFormat)),e.children.map(function(t){var e=n(t);e&&r.push(e)}),t.prototype.restore.call(this,e,n)},e.prototype.insert=function(t,e){return o(t)?(this._children.splice(e,0,t),this.insertImpl(t,e)):null},e.prototype.insertImpl=function(t,e){return t.parent=this,this.forward(t,"dirtyHeader.combine","dirtyValues.combine","dirty.combine","filterChanged.combine"),this.fire(["addColumn","dirtyHeader","dirtyValues","dirty"],t,e),t},e.prototype.push=function(t){return this.insert(t,this._children.length)},e.prototype.at=function(t){return this._children[t]},e.prototype.indexOf=function(t){return this._children.indexOf(t)},e.prototype.insertAfter=function(t,e){var n=this.indexOf(e);return n<0?null:this.insert(t,n+1)},e.prototype.remove=function(t){var e=this._children.indexOf(t);return!(e<0)&&(this._children.splice(e,1),this.removeImpl(t))},e.prototype.removeImpl=function(t){return t.parent=null,this.unforward(t,"dirtyHeader.combine","dirtyValues.combine","dirty.combine","filterChanged.combine"),
this.fire(["removeColumn","dirtyHeader","dirtyValues","dirty"],t),!0},e.prototype.getColor=function(t){return this.color},e.prototype.getLabel=function(t){var e=this.getValue(t);return""+("number"==typeof e?this.numberFormat(e):e)},e.prototype.getValue=function(t){var e=this.compute(t);return"undefined"==typeof e||null==e||isNaN(e)?this.missingValue:e},e.prototype.compute=function(t){return NaN},e.prototype.getNumber=function(t){return this.getValue(t)},e.prototype.compare=function(t,e){return i(this.getValue(t),this.getValue(e))},e.prototype.isFiltered=function(){return this._children.some(function(t){return t.isFiltered()})},e.prototype.filter=function(t){return this._children.every(function(e){return e.filter(t)})},e}(v);e.CompositeColumn=O;var D=function(t){function e(e,n){t.call(this,e,n),this.collapsed=!1;var r=this;this.adaptChange=function(t,e){r.adaptWidthChange(this.source,t,e)}}return g(e,t),e.desc=function(t){return void 0===t&&(t="Combined"),{type:"stack",label:t}},e.prototype.createEventList=function(){return t.prototype.createEventList.call(this).concat(["collapseChanged","weightsChanged"])},e.prototype.setCollapsed=function(t){this.collapsed!==t&&this.fire(["collapseChanged","dirtyHeader","dirtyValues","dirty"],this.collapsed,this.collapsed=t)},e.prototype.getCollapsed=function(){return this.collapsed},e.prototype.flatten=function(t,e,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var i=null,o=n<=v.FLAT_ALL_COLUMNS?this._children:this._children.filter(function(t){return!t.isHidden()});if(0===n||n<=v.FLAT_ALL_COLUMNS){var a=this.getCompressed()?v.COMPRESSED_WIDTH:this.getWidth();if(this.collapsed||this.getCompressed()||(a+=(o.length-1)*r),t.push(i={col:this,offset:e,width:a}),0===n)return a}var s=e;return o.forEach(function(e){s+=e.flatten(t,s,n-1,r)+r}),i&&(i.width=s-e-r),s-e-r},e.prototype.dump=function(e){var n=t.prototype.dump.call(this,e);return n.collapsed=this.collapsed,n},e.prototype.restore=function(e,n){this.collapsed=e.collapsed===!0,t.prototype.restore.call(this,e,n)},e.prototype.insert=function(e,n,r){return void 0===r&&(r=NaN),isNaN(r)||e.setWidth(r/(1-r)*this.getWidth()),e.on("widthChanged.stack",this.adaptChange),t.prototype.setWidth.call(this,0===this.length?e.getWidth():this.getWidth()+e.getWidth()),t.prototype.insert.call(this,e,n)},e.prototype.push=function(t,e){return void 0===e&&(e=NaN),this.insert(t,this.length,e)},e.prototype.insertAfter=function(t,e,n){void 0===n&&(n=NaN);var r=this.indexOf(e);return r<0?null:this.insert(t,r+1,n)},e.prototype.adaptWidthChange=function(t,e,n){if(e!==n){var r=this.getWeights(),i=this.getWidth(),o=(n-e)/i,a=e/i,s=(1-a-o)/(1-a);this._children.forEach(function(e){e===t||e.setWidthImpl(e.getWidth()*s)}),this.fire(["weightsChanged","dirtyHeader","dirtyValues","dirty"],r,this.getWeights())}},e.prototype.getWeights=function(){var t=this.getWidth();return this._children.map(function(e){return e.getWidth()/t})},e.prototype.setWeights=function(t){var e,n=this.getWeights(),r=t.length-this.length;if(r<0)if(e=m.sum(t),e<=1)for(var i=0;i<-r;++i)t.push((1-e)*(1/-r));else if(e<=100)for(var i=0;i<-r;++i)t.push((100-e)*(1/-r));t=t.slice(0,this.length),e=m.sum(t)/this.getWidth(),t=t.map(function(t){return t/e}),this._children.forEach(function(e,n){e.setWidthImpl(t[n])}),this.fire(["weightsChanged","dirtyHeader","dirtyValues","dirty"],n,t)},e.prototype.removeImpl=function(e){return e.on("widthChanged.stack",null),t.prototype.setWidth.call(this,1===this.length?100:this.getWidth()-e.getWidth()),t.prototype.removeImpl.call(this,e)},e.prototype.setWidth=function(e){var n=e/this.getWidth();this._children.forEach(function(t){t.setWidthImpl(t.getWidth()*n)}),t.prototype.setWidth.call(this,e)},e.prototype.compute=function(t){var e=this.getWidth();return this._children.reduce(function(n,r){return n+r.getValue(t)*(r.getWidth()/e)},0)},e}(O);e.StackColumn=D;var V=function(t){function e(e,n){t.call(this,e,n)}return g(e,t),e.desc=function(t){return void 0===t&&(t="Max"),{type:"max",label:t}},e.prototype.getColor=function(t){var e=this._children;if(0===e.length)return this.color;for(var n=0,r=e[0].getValue(t),i=1;i<e.length;++i){var o=e[i].getValue(t);o>r&&(n=i,r=o)}return e[n].color},e.prototype.compute=function(t){return m.max(this._children,function(e){return e.getValue(t)})},e}(O);e.MaxColumn=V;var A=function(t){function e(e,n){t.call(this,e,n)}return g(e,t),e.desc=function(t){return void 0===t&&(t="Min"),{type:"min",label:t}},e.prototype.getColor=function(t){var e=this._children;if(0===e.length)return this.color;for(var n=0,r=e[0].getValue(t),i=1;i<e.length;++i){var o=e[i].getValue(t);o<r&&(n=i,r=o)}return e[n].color},e.prototype.compute=function(t){return m.min(this._children,function(e){return e.getValue(t)})},e}(O);e.MinColumn=A;var H=function(t){function e(e,n){t.call(this,e,n)}return g(e,t),e.desc=function(t){return void 0===t&&(t="Mean"),{type:"mean",label:t}},e.prototype.compute=function(t){return m.mean(this._children,function(e){return e.getValue(t)})},e}(O);e.MeanColumn=H;var N=function(t){function e(n,r){t.call(this,n,r),this.script=e.DEFAULT_SCRIPT,this.f=null,this.script=r.script||this.script}return g(e,t),e.desc=function(t){return void 0===t&&(t="script"),{type:"script",label:t,script:e.DEFAULT_SCRIPT}},e.prototype.createEventList=function(){return t.prototype.createEventList.call(this).concat(["scriptChanged"])},e.prototype.setScript=function(t){this.script!==t&&(this.f=null,this.fire(["scriptChanged","dirtyValues","dirty"],this.script,this.script=t))},e.prototype.getScript=function(){return this.script},e.prototype.dump=function(e){var n=t.prototype.dump.call(this,e);return n.script=this.script,n},e.prototype.restore=function(e,n){this.script=e.script||this.script,t.prototype.restore.call(this,e,n)},e.prototype.compute=function(t){return null==this.f&&(this.f=new Function("children","values",this.script)),this.f.call(this,this._children,this._children.map(function(e){return e.getValue(t)}))},e.DEFAULT_SCRIPT="return d3.max(values)",e}(O);e.ScriptColumn=N;var M=function(t){function e(e,n){t.call(this,e,n),this.setWidthImpl(50)}return g(e,t),e.desc=function(t){return void 0===t&&(t="Rank"),{type:"rank",label:t}},e}(b);e.RankColumn=M;var T=function(t){function e(e){var n=this;t.call(this),this.id=e,this.sortColumn=null,this.ascending=!1,this.columns=[],this.comparator=function(t,e){if(null===n.sortColumn)return 0;var r=n.sortColumn.compare(t,e);return n.ascending?r:-r},this.dirtyOrder=function(){n.fire(["dirtyOrder","dirtyValues","dirty"],n.getSortCriteria())},this.order=[],this.id=r(e)}return g(e,t),e.prototype.createEventList=function(){return t.prototype.createEventList.call(this).concat(["widthChanged","filterChanged","labelChanged","compressChanged","addColumn","removeColumn","dirty","dirtyHeader","dirtyValues","sortCriteriaChanged","dirtyOrder","orderChanged"])},e.prototype.assignNewId=function(t){this.id=r(t()),this.columns.forEach(function(e){return e.assignNewId(t)})},e.prototype.setOrder=function(t){this.fire(["orderChanged","dirtyValues","dirty"],this.order,this.order=t)},e.prototype.getOrder=function(){return this.order},e.prototype.dump=function(t){var e={};return e.columns=this.columns.map(function(e){return e.dump(t)}),e.sortColumn={asc:this.ascending},this.sortColumn&&(e.sortColumn.sortBy=this.sortColumn.id),e},e.prototype.restore=function(t,e){var n=this;if(this.clear(),t.columns.map(function(t){var r=e(t);r&&n.push(r)}),t.sortColumn&&(this.ascending=t.sortColumn.asc,t.sortColumn.sortBy)){var r=this.columns.filter(function(e){return e.id===t.sortColumn.sortBy});this.sortBy(0===r.length?null:r[0],t.sortColumn.asc)}},e.prototype.flatten=function(t,e,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var i=e;return(n>0||n<=v.FLAT_ALL_COLUMNS)&&this.columns.forEach(function(e){(!e.isHidden()||n<=v.FLAT_ALL_COLUMNS)&&(i+=e.flatten(t,i,n-1,r)+r)}),i-e},e.prototype.getSortCriteria=function(){return{col:this.sortColumn,asc:this.ascending}},e.prototype.toggleSorting=function(t){return this.sortColumn===t?this.sortBy(t,!this.ascending):this.sortBy(t)},e.prototype.setSortCriteria=function(t){return this.sortBy(t.col,t.asc)},e.prototype.sortBy=function(t,e){if(void 0===e&&(e=!1),null!==t&&t.findMyRanker()!==this)return!1;if(this.sortColumn===t&&this.ascending===e)return!0;this.sortColumn&&this.sortColumn.on("dirtyValues.order",null);var n=this.getSortCriteria();return this.sortColumn=t,this.sortColumn&&this.sortColumn.on("dirtyValues.order",this.dirtyOrder),this.ascending=e,this.fire(["sortCriteriaChanged","dirtyOrder","dirtyHeader","dirtyValues","dirty"],n,this.getSortCriteria()),!0},Object.defineProperty(e.prototype,"children",{get:function(){return this.columns.slice()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this.columns.length},enumerable:!0,configurable:!0}),e.prototype.insert=function(t,e){return void 0===e&&(e=this.columns.length),this.columns.splice(e,0,t),t.parent=this,this.forward(t,"dirtyValues.ranking","dirtyHeader.ranking","dirty.ranking","filterChanged.ranking"),t.on("filterChanged.order",this.dirtyOrder),this.fire(["addColumn","dirtyHeader","dirtyValues","dirty"],t,e),null!==this.sortColumn||t instanceof M||t instanceof S||t instanceof C||this.sortBy(t,t instanceof E),t},Object.defineProperty(e.prototype,"fqpath",{get:function(){return""},enumerable:!0,configurable:!0}),e.prototype.findByPath=function(t){for(var e=this,n=t.split("@").map(Number).slice(1);n.length>0;){var r=n.shift();e=e.at(r)}return e},e.prototype.indexOf=function(t){return this.columns.indexOf(t)},e.prototype.at=function(t){return this.columns[t]},e.prototype.insertAfter=function(t,e){var n=this.columns.indexOf(e);return n<0?null:this.insert(t,n+1)},e.prototype.push=function(t){return this.insert(t)},e.prototype.remove=function(t){var e=this.columns.indexOf(t);if(e<0)return!1;if(this.unforward(t,"dirtyValues.ranking","dirtyHeader.ranking","dirty.ranking","filterChanged.ranking"),this.sortColumn===t){var n=this.columns.filter(function(e){return!(e===t||e instanceof S||e instanceof M)})[0];this.sortBy(n?n:null)}return t.parent=null,this.columns.splice(e,1),this.fire(["removeColumn","dirtyHeader","dirtyValues","dirty"],t,e),!0},e.prototype.clear=function(){var t=this;0!==this.columns.length&&(this.sortColumn=null,this.columns.forEach(function(e){t.unforward(e,"dirtyValues.ranking","dirtyHeader.ranking","dirty.ranking","filterChanged.ranking"),e.parent=null}),this.columns.length=0,this.fire(["removeColumn","dirtyHeader","dirtyValues","dirty"],null))},Object.defineProperty(e.prototype,"flatColumns",{get:function(){var t=[];return this.flatten(t,0,v.FLAT_ALL_COLUMNS),t.map(function(t){return t.col})},enumerable:!0,configurable:!0}),e.prototype.find=function(t){for(var e="string"==typeof t?function(e){return e.id===t}:t,n=this.flatColumns,r=0;r<n.length;++r)if(e(n[r]))return n[r];return null},e.prototype.toSortingDesc=function(t){var e=function(n){if(null===n)return null;if(n instanceof D){var r=n.getWeights();return n.children.map(function(t,n){return{weight:r[n],id:e(t)}})}return t(n.desc)},n=e(this.sortColumn);return null===n?null:{id:n,asc:this.ascending}},e.prototype.isFiltered=function(){return this.columns.some(function(t){return t.isFiltered()})},e.prototype.filter=function(t){return this.columns.every(function(e){return e.filter(t)})},e.prototype.findMyRanker=function(){return this},Object.defineProperty(e.prototype,"fqid",{get:function(){return this.id},enumerable:!0,configurable:!0}),e}(y.AEventDispatcher);e.Ranking=T,e.defineColumn=d,e.createStackDesc=D.desc,e.createRankDesc=M.desc,e.createSelectionDesc=S.desc,e.createMinDesc=A.desc,e.createMaxDesc=V.desc,e.createMeanDesc=H.desc,e.createScriptDesc=N.desc,e.createActionDesc=h,e.models=f},function(e,n){e.exports=t},function(t,e,n){"use strict";function r(t,e,n){void 0===e&&(e=100),void 0===n&&(n=this);var r=-1;return function(){for(var i=[],o=0;o<arguments.length;o++)i[o-0]=arguments[o];r>=0&&(clearTimeout(r),r=-1),i.unshift(null===n?this:n),r=setTimeout(t.bind.apply(t,i),e)}}function i(t,e){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r-0]=arguments[r];n.unshift(e||this.type),t.fire.apply(t,n)}}function o(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];for(var n=null,r=0;r<t.length;r++){var i=t[r],a=Object.keys(i);if(null!==n)for(var s=0;s<a.length;s++){var l=a[s],c=i[l];Object.prototype.toString.call(c)===f&&Object.getPrototypeOf(c)===Object.prototype?(void 0===n[l]&&(n[l]={}),n[l]=o(n[l],c)):Object.prototype.toString.call(c)===g?(void 0===n[l]&&(n[l]=[]),n[l]=c.concat(n[l])):n[l]=c}else n=i}return n}function a(t){var e=t.getBoundingClientRect();return{left:e.left+window.pageXOffset,top:e.top+window.pageYOffset,width:e.width,height:e.height}}function s(t,e){var n=t.dataTransfer.types;return"function"==typeof n.indexOf?e.some(function(t){return n.indexOf(t)>=0}):"function"==typeof n.includes?e.some(function(t){return n.includes(t)}):"function"==typeof n.contains&&e.some(function(t){return n.contains(t)})}function l(t){var e=t.dataTransfer;return t.ctrlKey&&null!=e.effectAllowed.match(/copy/gi)||null==e.effectAllowed.match(/move/gi)}function c(t){var e=t.dataTransfer;l(t)?e.dropEffect="copy":e.dropEffect="move"}function u(t,e){return function(n){n.on("dragenter",function(){var e=d.event;return s(e,t)?(d.select(this).classed("drag_over",!0),!1):void d.select(this).classed("drag_over",!1)}).on("dragover",function(){var e=d.event;if(s(e,t))return e.preventDefault(),c(e),d.select(this).classed("drag_over",!0),!1}).on("dragleave",function(){d.select(this).classed("drag_over",!1)}).on("drop",function(n){var r=d.event;if(r.preventDefault(),d.select(this).classed("drag_over",!1),s(r,t)){var i={};return t.forEach(function(t){var e=r.dataTransfer.getData(t);""!==e&&(i[t]=e)}),e(i,n,l(r))}})}}var p=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},d=n(5);e.delayedCall=r,e.forwardEvent=i;var h=function(){function t(){this.forwarder=i(this),this.listeners=d.dispatch.apply(d,this.createEventList())}return t.prototype.on=function(t,e){var n=this;return arguments.length>1?(Array.isArray(t)?t.forEach(function(t){return n.listeners.on(t,e)}):this.listeners.on(t,e),this):this.listeners.on(t)},t.prototype.createEventList=function(){return[]},t.prototype.fire=function(t){for(var e=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i=function(t){var r={source:e,type:t,args:n};e.listeners[t].apply(r,n)};Array.isArray(t)?t.forEach(i.bind(this)):i(t)},t.prototype.forward=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];t.on(e,this.forwarder)},t.prototype.unforward=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];t.on(e,null)},t}();e.AEventDispatcher=h;var f="[object Object]",g="[object Array]";e.merge=o,e.offset=a;var m=function(t){function e(e,n,r){var i=this;void 0===r&&(r={}),t.call(this),this.container=e,this.content=n,this.options={topShift:function(){return 0},backupRows:5,rowHeight:10},this.prevScrollTop=0,this.shift=0,o(this.options,r),d.select(e).on("scroll.scroller",function(){return i.onScroll()}),this.prevScrollTop=e.scrollTop,this.shift=a(n).top-a(e).top}return p(e,t),e.prototype.createEventList=function(){return t.prototype.createEventList.call(this).concat(["scroll","redraw"])},e.prototype.select=function(t,e,n){var r,i=this.container.scrollTop-this.shift-this.options.topShift(),o=i+this.container.clientHeight,a=0;if(i>0){for(a=Math.round(i/this.options.rowHeight);a>=t&&n(a+1)>i;)a--;a-=this.options.backupRows}for(r=Math.round(o/this.options.rowHeight);r<=e&&n(r-1)<o;)r++;return r+=this.options.backupRows,{from:Math.max(a,t),to:Math.min(r,e)}},e.prototype.onScroll=function(){var t=this.container.scrollTop,e=this.container.scrollLeft;this.fire("scroll",t,e),Math.abs(this.prevScrollTop-t)>=this.options.rowHeight*this.options.backupRows&&(this.prevScrollTop=t,this.fire("redraw"))},e.prototype.destroy=function(){d.select(this.container).on("scroll.scroller",null)},e}(h);e.ContentScroller=m,e.hasDnDType=s,e.copyDnD=l,e.updateDropEffect=c,e.dropAble=u},function(t,e,n){"use strict";function r(t,e,n){if(0===t.length)return{min:NaN,max:NaN,mean:NaN,count:0,maxBin:0,hist:[]};var r=c.layout.histogram().value(e);n&&r.range(function(){return n});var i=c.extent(t,e),o=r(t);return{min:i[0],max:i[1],mean:c.mean(t,e),count:t.length,maxBin:c.max(o,function(t){return t.y}),hist:o}}function i(t,e,n){var r=c.map();return n.forEach(function(t){return r.set(t,0)}),t.forEach(function(t){var n=e(t);null!=n&&n.forEach(function(t){r.set(t,(r.get(t)||0)+1)})}),{maxBin:c.max(r.values()),hist:r.entries().map(function(t){return{cat:t.key,y:t.value}})}}function o(t){return["rank","selection","actions"].indexOf(t.type)>=0}var a=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},s=n(4),l=n(6),c=n(5),u=function(t){function e(e){var n=this;void 0===e&&(e={}),t.call(this),this.rankings_=[],this.selection=c.set(),this.uid=0,this.columnTypes=l.merge({},s.models()),this.createHelper=function(t){var e=n.fromDescRef(t.desc),r=null;if(e&&e.type){n.fixDesc(t.desc);var i=n.columnTypes[e.type];r=new i(t.id,e),r.restore(t,n.createHelper)}return r},this.columnTypes=l.merge(s.models(),e.columnTypes||{})}return a(e,t),e.prototype.createEventList=function(){return t.prototype.createEventList.call(this).concat(["addColumn","removeColumn","addRanking","removeRanking","dirty","dirtyHeader","dirtyValues","orderChanged","selectionChanged"])},e.prototype.getColumns=function(){return[]},e.prototype.pushRanking=function(t){var e=this.cloneRanking(t);return this.insertRanking(e),e},e.prototype.takeSnapshot=function(t){var e=this.cloneRanking();return e.push(this.clone(t)),this.insertRanking(e),e},e.prototype.insertRanking=function(t,e){void 0===e&&(e=this.rankings_.length),this.rankings_.splice(e,0,t),this.forward(t,"addColumn.provider","removeColumn.provider","dirty.provider","dirtyHeader.provider","orderChanged.provider","dirtyValues.provider");var n=this;t.on("dirtyOrder.provider",l.delayedCall(function(){n.triggerReorder(this.source)},100,null)),this.fire(["addRanking","dirtyHeader","dirtyValues","dirty"],t,e),this.triggerReorder(t)},e.prototype.triggerReorder=function(t){this.sort(t).then(function(e){return t.setOrder(e)})},e.prototype.removeRanking=function(t){var e=this.rankings_.indexOf(t);return!(e<0)&&(this.unforward(t,"addColumn.provider","removeColumn.provider","dirty.provider","dirtyHeader.provider","orderChanged.provider","dirtyOrder.provider","dirtyValues.provider"),this.rankings_.splice(e,1),t.on("dirtyOrder.provider",null),this.cleanUpRanking(t),this.fire(["removeRanking","dirtyHeader","dirtyValues","dirty"],t,e),!0)},e.prototype.clearRankings=function(){var t=this;this.rankings_.forEach(function(e){t.unforward(e,"addColumn.provider","removeColumn.provider","dirty.provider","dirtyHeader.provider","dirtyOrder.provider","dirtyValues.provider"),e.on("dirtyOrder.provider",null),t.cleanUpRanking(e)}),this.rankings_=[],this.fire(["removeRanking","dirtyHeader","dirtyValues","dirty"],null)},e.prototype.getRankings=function(){return this.rankings_.slice()},e.prototype.getLastRanking=function(){return this.rankings_[this.rankings_.length-1]},e.prototype.cleanUpRanking=function(t){},e.prototype.cloneRanking=function(t){return null},e.prototype.push=function(t,e){var n=this.create(e);return n?(t.push(n),n):null},e.prototype.insert=function(t,e,n){var r=this.create(n);return r?(t.insert(r,e),r):null},e.prototype.nextId=function(){return"col"+this.uid++},e.prototype.rankAccessor=function(t,e,n,r){return 0},e.prototype.fixDesc=function(t){var e=this;"rank"===t.type?t.accessor=this.rankAccessor.bind(this):"selection"===t.type&&(t.accessor=function(t){return e.isSelected(t._index)},t.setter=function(t,n){return n?e.select(t._index):e.deselect(t._index)})},e.prototype.create=function(t){this.fixDesc(t);var e=this.columnTypes[t.type];return e?new e(this.nextId(),t):null},e.prototype.clone=function(t){var e=this.dumpColumn(t);return this.restoreColumn(e)},e.prototype.restoreColumn=function(t){var e=this,n=function(t){var r=e.fromDescRef(t.desc),i=e.columnTypes[r.type];e.fixDesc(r);var o=new i("",r);return o.restore(t,n),o.assignNewId(e.nextId.bind(e)),o};return n(t)},e.prototype.find=function(t){for(var e="string"==typeof t?function(e){return e.id===t}:t,n=0;n<this.rankings_.length;++n){var r=this.rankings_[n].find(e);if(r)return r}return null},e.prototype.dump=function(){var t=this;return{uid:this.uid,selection:this.selection.values().map(Number),rankings:this.rankings_.map(function(e){return e.dump(t.toDescRef)})}},e.prototype.dumpColumn=function(t){return t.dump(this.toDescRef)},e.prototype.toDescRef=function(t){return t},e.prototype.fromDescRef=function(t){return t},e.prototype.restoreRanking=function(t){var e=this.cloneRanking();e.restore(t,this.createHelper),e.children.some(function(t){return t instanceof s.RankColumn})||e.insert(this.create(s.RankColumn.desc()),0);var n=this.nextId.bind(this);return e.children.forEach(function(t){return t.assignNewId(n)}),e},e.prototype.restore=function(t){var e=this;this.clearRankings(),this.uid=t.uid||0,t.selection&&t.selection.forEach(function(t){return e.selection.add(String(t))}),t.rankings&&t.rankings.forEach(function(t){var n=e.cloneRanking();n.restore(t,e.createHelper),n.children.some(function(t){return t instanceof s.RankColumn})||n.insert(e.create(s.RankColumn.desc()),0),e.insertRanking(n)}),t.layout&&Object.keys(t.layout).forEach(function(n){e.deriveRanking(t.layout[n])});var n=this.nextId.bind(this);this.rankings_.forEach(function(t){t.children.forEach(function(t){return t.assignNewId(n)})})},e.prototype.findDesc=function(t){return null},e.prototype.deriveDefault=function(){var t=this;if(!(this.rankings_.length>0)){var e=this.pushRanking();this.getColumns().forEach(function(n){o(n)||t.push(e,n)})}},e.prototype.deriveRanking=function(t){var e=this,n=this.cloneRanking();n.clear();var r=function(t){if("rank"===t.type)return e.create(s.createRankDesc());if("selection"===t.type)return e.create(s.createSelectionDesc());if("actions"===t.type){var n=e.create(s.createActionDesc(t.label||"actions"));return n.restore(t,null),n}if("stacked"===t.type){var i=e.create(s.createStackDesc(t.label||"Combined"));return(t.children||[]).forEach(function(t){var e=r(t);e&&i.push(e)}),i}var o=e.findDesc(t.column);if(o){var n=e.create(o);return t.label=t.label||o.label||o.column,n.restore(t,null),n}return null};return t.forEach(function(t){var e=r(t);e&&n.push(e)}),n.children.some(function(t){return t instanceof s.RankColumn})||n.insert(this.create(s.createRankDesc()),0),this.insertRanking(n),n},e.prototype.sort=function(t){return Promise.reject("not implemented")},e.prototype.view=function(t){return Promise.reject("not implemented")},e.prototype.mappingSample=function(t){return Promise.reject("not implemented")},e.prototype.stats=function(t){return{stats:function(t){return Promise.reject("not implemented")},hist:function(t){return Promise.reject("not implemented")}}},e.prototype.rowKey=function(t,e){return"number"==typeof t?String(t):String(t._index)},e.prototype.isSelected=function(t){return this.selection.has(String(t))},e.prototype.select=function(t){this.selection.add(String(t)),this.fire("selectionChanged",this.selection.values().map(Number))},e.prototype.searchSelect=function(t,e){},e.prototype.selectAll=function(t){var e=this;t.forEach(function(t){e.selection.add(String(t))}),this.fire("selectionChanged",this.selection.values().map(Number))},e.prototype.setSelection=function(t){var e=this;this.selection.size()===t.length&&t.every(function(t){return e.selection.has(String(t))})||(this.selection=c.set(),this.selectAll(t))},e.prototype.toggleSelection=function(t,e){return void 0===e&&(e=!1),this.isSelected(t)?(e?this.deselect(t):this.clearSelection(),!1):(e?this.select(t):this.setSelection([t]),!0)},e.prototype.deselect=function(t){this.selection.remove(String(t)),this.fire("selectionChanged",this.selection.values().map(Number))},e.prototype.selectedRows=function(){return this.selection.empty()?Promise.resolve([]):this.view(this.getSelection())},e.prototype.getSelection=function(){var t=[];return this.selection.forEach(function(e){return t.push(+e)}),t.sort(),t},e.prototype.clearSelection=function(){this.selection=c.set(),this.fire("selectionChanged",[])},e.prototype.exportTable=function(t,e){function n(t,e){return!r.quote||e&&s.isNumberColumn(e)?t:r.quoteChar+t+r.quoteChar}void 0===e&&(e={});var r={separator:"\t",newline:"\n",header:!0,quote:!1,quoteChar:'"'};l.merge(r,e);var i=t.flatColumns;return this.view(t.getOrder()).then(function(t){var e=[];return r.header&&e.push(i.map(function(t){return n(t.label)}).join(r.separator)),t.forEach(function(t){e.push(i.map(function(e){return n(e.getLabel(t),e)}).join(r.separator))}),e.join(r.newline)})},e}(l.AEventDispatcher);e.DataProvider=u;var p=function(t){function e(e,n){var r=this;void 0===e&&(e=[]),void 0===n&&(n={}),t.call(this,n),this.columns=e,this.rankingIndex=0,this.rowGetter=function(t,e,n){return t[n.column]},e.forEach(function(t){t.accessor=t.accessor||r.rowGetter,t.label=t.label||t.column})}return a(e,t),e.prototype.createEventList=function(){return t.prototype.createEventList.call(this).concat(["addDesc"])},e.prototype.pushDesc=function(t){var e=t;e.accessor=e.accessor||this.rowGetter,e.label=t.label||e.column,this.columns.push(t),this.fire("addDesc",e)},e.prototype.getColumns=function(){return this.columns.slice()},e.prototype.findDesc=function(t){return this.columns.filter(function(e){return e.column===t})[0]},e.prototype.toDescRef=function(t){return t.column?t.type+"@"+t.column:t},e.prototype.fromDescRef=function(t){return"string"==typeof t?this.columns.filter(function(e){return e.type+"@"+e.column===t})[0]:t},e.prototype.restore=function(e){t.prototype.restore.call(this,e),this.rankingIndex=1+c.max(this.getRankings(),function(t){return+t.id.substring(4)})},e.prototype.nextRankingId=function(){return"rank"+this.rankingIndex++},e}(u);e.CommonDataProvider=p;var d=function(t){function e(e,n,r){void 0===n&&(n=[]),void 0===r&&(r={}),t.call(this,n,r),this.data=e,this.options={filterGlobally:!1},l.merge(this.options,r),e.forEach(function(t,e){t._rankings={},t._index=e});var i=this;this.reorderall=function(){var t=this.source;i.getRankings().forEach(function(e){e!==t&&e.dirtyOrder()})}}return a(e,t),e.prototype.setData=function(t){t.forEach(function(t,e){t._rankings={},t._index=e}),this.data=t,this.reorderall()},e.prototype.clearData=function(){this.setData([])},e.prototype.appendData=function(t){var e=this.data.length;t.forEach(function(t,n){t._rankings={},t._index=e+n}),this.data.push.apply(this.data,t),this.reorderall()},e.prototype.rankAccessor=function(t,e,n,r){return t._rankings[r.id]+1||1},e.prototype.cloneRanking=function(t){var e=this,n=this.nextRankingId(),r=new s.Ranking(n);return t?(this.data.forEach(function(e){var r=e._rankings;r[n]=r[t.id]}),t.children.forEach(function(t){e.push(r,t.desc)})):r.push(this.create(s.createRankDesc())),this.options.filterGlobally&&r.on("filterChanged.reorderall",this.reorderall),r},e.prototype.cleanUpRanking=function(t){this.options.filterGlobally&&t.on("filterChanged.reorderall",null),this.data.forEach(function(e){return delete e._rankings[t.id]})},e.prototype.sort=function(t){if(0===this.data.length)return Promise.resolve([]);var e=this.data.map(function(e,n){return{row:e,i:n,prev:e._rankings[t.id]||0}});if(this.options.filterGlobally){var n=this.getRankings().filter(function(t){return t.isFiltered()});n.length>0&&(e=e.filter(function(t){return n.every(function(e){return e.filter(t.row)})}))}else t.isFiltered()&&(e=e.filter(function(e){return t.filter(e.row)}));e.sort(function(e,n){return t.comparator(e.row,n.row)});var r=e.map(function(e,n){return e.row._rankings[t.id]=n,e.i});return Promise.resolve(r)},e.prototype.view=function(t){var e=this;if(0===this.data.length)return Promise.resolve([]);var n=this.data.length,r=t.filter(function(t){return t>=0&&t<n}).map(function(t){return e.data[t]});return Promise.resolve(r)},e.prototype.stats=function(t){var e=this,n=null,o=function(){return null===n?n=e.view(t):n};return{stats:function(t){return o().then(function(e){return r(e,t.getNumber.bind(t),[0,1])})},hist:function(t){return o().then(function(e){return i(e,t.getCategories.bind(t),t.categories)})}}},e.prototype.mappingSample=function(t){var e=this,n=500,r=this.data.length;if(r<=n)return Promise.resolve(this.data.map(t.getRawValue.bind(t)));for(var i=[],o=0;o<n;++o){for(var a=Math.floor(Math.random()*(r-1));i.indexOf(a)>=0;)a=Math.floor(Math.random()*(r-1));i.push(a)}return Promise.resolve(i.map(function(n){return t.getRawValue(e.data[n])}))},e.prototype.searchSelect=function(t,e){var n="string"==typeof t?function(e){return e.indexOf(t)>=0}:function(e){return null!=e.match(t)},r=this.data.filter(function(t){return n(e.getLabel(t))}).map(function(t){return t._index});this.setSelection(r)},e}(p);e.LocalDataProvider=d;var h=function(t){function e(e,n,r){void 0===n&&(n=[]),void 0===r&&(r={}),t.call(this,n,r),this.server=e,this.ranks={}}return a(e,t),e.prototype.rankAccessor=function(t,e,n,r){return this.ranks[r.id][t._index]||0},e.prototype.cloneRanking=function(t){var e=this.nextRankingId();t&&(this.ranks[e]=this.ranks[t.id]);var n=new s.Ranking(e);return n.push(this.create(s.createRankDesc())),n},e.prototype.cleanUpRanking=function(t){delete this.ranks[t.id]},e.prototype.sort=function(t){var e=this,n=t.toSortingDesc(function(t){return t.column});return this.server.sort(n).then(function(n){return e.ranks[t.id]=n,n})},e.prototype.view=function(t){return this.server.view(t).then(function(e){return e.forEach(function(e,n){return e._index=t[n]}),e})},e.prototype.mappingSample=function(t){return this.server.mappingSample(t.desc.column)},e.prototype.searchSelect=function(t,e){var n=this;this.server.search(t,e.desc.column).then(function(t){n.setSelection(t)})},e}(p);e.RemoteDataProvider=h},function(t,e,n){"use strict";function r(t){return t?new u(t):y}function i(t){return t?new h(t):v}function o(t,e,n){var r=this;void 0===n&&(n={}),n.selector=t,n.render=e,n.findRow=function(t,e){return t.selectAll(r.selector+'[data-index="'+e+'"]')};var i=new u(n);return i}function a(){return{string:new C,link:new b,number:i(),rank:r({textClass:"rank",align:"right"}),"boolean":r({textClass:"boolean",align:"center"}),heatmap:new d,stack:new x,categorical:new k,ordinal:w,max:w,min:w,mean:w,script:w,actions:new f,annotate:new m,selection:new g}}var s=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},l=n(4),c=function(){function t(){this.textClass="text",this.align="left"}return t.prototype.render=function(t,e,n,r){var i=t.datum(e).selectAll("text."+this.textClass).data(n,r.rowKey);i.enter().append("text").attr({"class":this.textClass,"clip-path":"url(#"+r.idPrefix+"clipCol"+e.id+")",y:function(t,e){return r.cellPrevY(e)}});var o=2;"right"===this.align?o=e.getWidth()-5:"center"===this.align&&(o=.5*e.getWidth()),i.attr({x:function(t,e){return r.cellX(e)+o},"data-index":function(t,e){return e}}).text(function(t){return e.getLabel(t)}),r.animated(i).attr({y:function(t,e){return r.cellY(e)}}),i.exit().remove()},t.prototype.findRow=function(t,e){return t.selectAll("text."+this.textClass+'[data-index="'+e+'"]')},t.prototype.mouseEnter=function(t,e,n,r,i,o){var a=e.node(),s=this.findRow(t,i).node();s&&a.appendChild(s)},t.prototype.mouseLeave=function(t,e,n,r,i,o){var a=t.node(),s=e.node();s.hasChildNodes()&&a&&a.appendChild(s.firstChild),e.selectAll("*").remove()},t.prototype.renderCanvas=function(t,e,n,r){var i=this;t.save(),t.textAlign=this.align,
n.forEach(function(n,o){var a=r.cellY(o),s=2;"right"===i.align?s=e.getWidth()-5:"center"===i.align&&(s=.5*e.getWidth());var l=r.cellX(o)+s;t.fillText(e.getLabel(n),l,a,e.getWidth())}),t.restore()},t.prototype.mouseEnterCanvas=function(t,e,n,r,i){},t}();e.DefaultCellRenderer=c;var u=function(t){function e(e){var n=this;t.call(this),Object.keys(e).forEach(function(t){n[t]=e[t]})}return s(e,t),e}(c),p=function(t){function e(){t.apply(this,arguments)}return s(e,t),e.prototype.render=function(t,e,n,r){var i=this,o=t.datum(e).selectAll("rect.bar").data(n,r.rowKey);o.enter().append("rect").attr({"class":"bar "+e.cssClass,x:function(t,e){return r.cellX(e)},y:function(t,e){return r.cellPrevY(e)+r.option("rowPadding",1)},width:function(t){var n=e.getWidth()*e.getValue(t);return isNaN(n)?0:n}}).style("fill",e.color),o.attr({"data-index":function(t,e){return e},height:function(t,e){return r.rowHeight(e)-2*r.option("rowPadding",1)}}),r.animated(o).attr({x:function(t,e){return r.cellX(e)},y:function(t,e){return r.cellY(e)+r.option("rowPadding",1)},width:function(t){var n=e.getWidth()*e.getValue(t);return isNaN(n)?0:n}}).style({fill:function(t,n){return i.colorOf(t,n,e)}}),o.exit().remove()},e.prototype.colorOf=function(t,e,n){return n.color},e.prototype.findRow=function(t,e){return t.selectAll('rect.bar[data-index="'+e+'"]')},e.prototype.mouseEnter=function(t,e,n,r,i,o){var a=this.findRow(t,i);a.empty()||(e.node().appendChild(a.node()),e.append("text").datum(a.datum()).attr({"class":"number","clip-path":"url(#"+o.idPrefix+"clipCol"+n.id+")",transform:"translate("+o.cellX(i)+","+o.cellY(i)+")"}).text(function(t){return n.getLabel(t)}))},e.prototype.renderCanvas=function(t,e,n,r){var i=this;t.save(),n.forEach(function(n,o){var a=r.cellX(o),s=r.cellY(o)+r.option("rowPadding",1),c=e.getWidth()*e.getValue(n),u=isNaN(c)?0:c,p=r.rowHeight(o)-2*r.option("rowPadding",1);t.fillStyle=i.colorOf(n,o,e)||e.color||l.Column.DEFAULT_COLOR,t.fillRect(a,s,u,p)}),t.restore()},e.prototype.mouseEnterCanvas=function(t,e,n,r,i){t.save(),t.fillText(e.getLabel(n),i.cellX(r),i.cellY(r),e.getWidth()),t.restore()},e}(c);e.BarCellRenderer=p;var d=function(t){function e(){t.apply(this,arguments)}return s(e,t),e.prototype.render=function(t,e,n,r){var i=this,o=t.datum(e).selectAll("rect.heatmap").data(n,r.rowKey);o.enter().append("rect").attr({"class":"bar "+e.cssClass,x:function(t,e){return r.cellX(e)},y:function(t,e){return r.cellPrevY(e)+r.option("rowPadding",1)},width:function(t,e){return r.rowHeight(e)-2*r.option("rowPadding",1)}}).style("fill",e.color),o.attr({"data-index":function(t,e){return e},width:function(t,e){return r.rowHeight(e)-2*r.option("rowPadding",1)},height:function(t,e){return r.rowHeight(e)-2*r.option("rowPadding",1)}}),r.animated(o).attr({x:function(t,e){return r.cellX(e)},y:function(t,e){return r.cellY(e)+r.option("rowPadding",1)}}).style({fill:function(t,n){return i.colorOf(t,n,e)}}),o.exit().remove()},e.prototype.colorOf=function(t,e,n){var r=n.getValue(t);isNaN(r)&&(r=0);var i=d3.hsl(n.color||l.Column.DEFAULT_COLOR);return i.l=r,i.toString()},e.prototype.findRow=function(t,e){return t.selectAll('rect.heatmap[data-index="'+e+'"]')},e.prototype.mouseEnter=function(t,e,n,r,i,o){var a=this.findRow(t,i);a.empty()||(e.node().appendChild(a.node()),e.append("text").datum(a.datum()).attr({"class":"number","clip-path":"url(#"+o.idPrefix+"clipCol"+n.id+")",transform:"translate("+o.cellX(i)+","+o.cellY(i)+")"}).text(function(t){return n.getLabel(t)}))},e.prototype.renderCanvas=function(t,e,n,r){var i=this;t.save(),n.forEach(function(n,o){var a=r.cellX(o),s=r.cellY(o)+r.option("rowPadding",1),l=r.rowHeight(o)-2*r.option("rowPadding",1);t.fillStyle=i.colorOf(n,o,e),t.fillRect(a,s,l,l)}),t.restore()},e.prototype.mouseEnterCanvas=function(t,e,n,r,i){t.save(),t.fillText(e.getLabel(n),i.cellX(r),i.cellY(r),e.getWidth()),t.restore()},e}(c);e.HeatMapCellRenderer=d;var h=function(t){function e(e){var n=this;t.call(this),Object.keys(e).forEach(function(t){n[t]=e[t]})}return s(e,t),e}(p),f=function(){function t(){}return t.prototype.render=function(t,e,n,r){},t.prototype.mouseEnter=function(t,e,n,r,i,o){var a=o.option("actions",[]),s=e.append("text").attr({"class":"actions fa",x:o.cellX(i),y:o.cellPrevY(i),"data-index":i}).selectAll("tspan").data(a);s.enter().append("tspan").text(function(t){return t.icon}).attr("title",function(t){return t.name}).on("click",function(t){d3.event.preventDefault(),d3.event.stopPropagation(),t.action(r)})},t.prototype.mouseLeave=function(t,e,n,r,i,o){e.selectAll("*").remove()},t}();e.ActionCellRenderer=f;var g=function(t){function e(){t.call(this),this.textClass="selection"}return s(e,t),e.prototype.render=function(t,e,n,r){var i=t.datum(e).selectAll("text."+this.textClass).data(n,r.rowKey);i.enter().append("text").attr({"class":this.textClass+" fa",y:function(t,e){return r.cellPrevY(e)}}).on("click",function(t){d3.event.preventDefault(),d3.event.stopPropagation();var n=e.toggleValue(t);d3.select(this).text(n===!0?"":"")}),i.attr({x:function(t,e){return r.cellX(e)},"data-index":function(t,e){return e}}).text(function(t){return e.getValue(t)===!0?"":""}),r.animated(i).attr({y:function(t,e){return r.cellY(e)}}),i.exit().remove()},e.prototype.renderCanvas=function(t,e,n,r){t.save(),t.font="FontAwesome",n.forEach(function(n,i){var o=r.cellX(i),a=r.cellY(i);t.fillText(e.getValue(n)===!0?"":"",o,a)}),t.restore()},e}(c);e.SelectionCellRenderer=g;var m=function(t){function e(){t.apply(this,arguments)}return s(e,t),e.prototype.mouseEnter=function(t,e,n,r,i,o){this.findRow(t,i).attr("display","none"),e.append("foreignObject").attr({x:o.cellX(i)-2,y:o.cellPrevY(i)-2,"data-index":i,width:n.getWidth(),height:o.rowHeight(i)}).append("xhtml:input").attr({type:"text",value:n.getValue(r)}).style({width:n.getWidth()+"px"}).on("change",function(){var t=this.value;n.setValue(r,t)}).on("click",function(){return d3.event.stopPropagation()})},e.prototype.mouseLeave=function(t,e,n,r,i,o){this.findRow(t,i).attr("display",null);var a=e.select("input").node();a&&n.setValue(r,a.value),e.selectAll("*").remove()},e}(c),y=new c,v=new p;e.defaultRenderer=r,e.barRenderer=i;var b=function(t){function e(){t.apply(this,arguments)}return s(e,t),e.prototype.render=function(t,e,n,r){var i=t.datum(e).selectAll("text.link").data(n,r.rowKey);i.enter().append("text").attr({"class":"text link","clip-path":"url(#"+r.idPrefix+"clipCol"+e.id+")",y:function(t,e){return r.cellPrevY(e)}}),i.attr({x:function(t,e){return r.cellX(e)},"data-index":function(t,e){return e}}).html(function(t){return e.isLink(t)?'<a class="link" xlink:href="'+e.getValue(t)+'" target="_blank">'+e.getLabel(t)+"</a>":e.getLabel(t)}),r.animated(i).attr({y:function(t,e){return r.cellY(e)}}),i.exit().remove()},e.prototype.findRow=function(t,e){return t.selectAll('text.link[data-index="'+e+'"]')},e}(c),C=function(t){function e(){t.apply(this,arguments)}return s(e,t),e.prototype.render=function(e,n,r,i){return this.align=n.alignment,this.textClass="text"+("left"===n.alignment?"":"_"+n.alignment),t.prototype.render.call(this,e,n,r,i)},e}(c),k=function(t){function e(){t.apply(this,arguments),this.textClass="cat"}return s(e,t),e.prototype.render=function(t,e,n,r){var i=t.datum(e).selectAll("g."+this.textClass).data(n,r.rowKey),o=i.enter().append("g").attr({"class":this.textClass,"data-index":function(t,e){return e},transform:function(t,e){return"translate("+r.cellX(e)+","+r.cellPrevY(e)+")"}});o.append("text").attr({"clip-path":"url(#"+r.idPrefix+"clipCol"+e.id+")",x:function(t,e){return r.rowHeight(e)}}),o.append("rect").attr({y:r.option("rowPadding",1)}),i.attr({"data-index":function(t,e){return e},transform:function(t,e){return"translate("+r.cellX(e)+","+r.cellY(e)+")"}}),i.select("text").attr({x:function(t,e){return r.rowHeight(e)}}).text(function(t){return e.getLabel(t)}),i.select("rect").style({fill:function(t){return e.getColor(t)}}).attr({height:function(t,e){return Math.max(r.rowHeight(e)-2*r.option("rowPadding",1),0)},width:function(t,e){return Math.max(r.rowHeight(e)-2*r.option("rowPadding",1),0)}}),r.animated(i).attr({transform:function(t,e){return"translate("+r.cellX(e)+","+r.cellY(e)+")"}}),i.exit().remove()},e.prototype.findRow=function(t,e){return t.selectAll("g."+this.textClass+'[data-index="'+e+'"]')},e.prototype.renderCanvas=function(t,e,n,r){t.save(),n.forEach(function(n,i){var o=r.cellX(i),a=r.cellY(i);t.fillStyle="black",t.fillText(e.getLabel(n),o+r.rowHeight(i),a),t.fillStyle=e.getColor(n),t.fillRect(o,a+r.option("rowPadding",1),Math.max(r.rowHeight(i)-2*r.option("rowPadding",1),0),Math.max(r.rowHeight(i)-2*r.option("rowPadding",1),0))})},e}(c),x=function(t){function e(){t.apply(this,arguments)}return s(e,t),e.prototype.renderImpl=function(t,e,n,r,i,o){void 0===o&&(o=!0);var a=t.datum(e),s=e.children,l=n.showStacked(e),c=0,u=s.map(function(t){var e=c;return c+=t.getWidth(),c+=l?0:n.option("columnPadding",0),e}),p="component"+n.option("stackLevel",""),d=n.cellX,h=n.option;n.option=function(t,e){var n=h(t,e);return"stackLevel"===t?n+"N":n};var f=a.selectAll("g."+p).data(s,function(t){return t.id});f.enter().append("g").attr({"class":p,transform:function(t,e){return"translate("+u[e]+",0)"}}),f.attr({"class":function(t){return p+" "+t.desc.type},"data-stack":function(t,e){return e}}).each(function(t,e){if(l){var o=s.slice(0,e);n.cellX=function(t){return d(t)-o.reduce(function(e,n){return e+n.getWidth()*(1-n.getValue(i(t)))},0)}}r(d3.select(this),t,e,n)}),(o?n.animated(f):f).attr({transform:function(t,e){return"translate("+u[e]+",0)"}}),f.exit().remove(),n.cellX=d,n.option=h},e.prototype.render=function(t,e,n,r){this.renderImpl(t,e,r,function(t,e,r,i){i.render(e,t,n,i)},function(t){return n[t]})},e.prototype.mouseEnter=function(t,e,n,r,i,o){var a="component"+o.option("stackLevel","");this.renderImpl(e,n,o,function(e,n,o,s){var l=t.select("g."+a+'[data-stack="'+o+'"]');l.empty()||s.renderer(n).mouseEnter(l,e,n,r,i,s)},function(t){return r},!1)},e.prototype.mouseLeave=function(t,e,n,r,i,o){var a="component"+o.option("stackLevel","");this.renderImpl(e,n,o,function(e,n,o,s){var l=t.select("g."+a+'[data-stack="'+o+'"]');l.empty()||s.renderer(n).mouseLeave(l,e,n,r,i,s)},function(t){return r},!1),e.selectAll("*").remove()},e.prototype.renderCanvas=function(t,e,n,r){var i=e.children,o=r.showStacked(e),a=0,s=i.map(function(t){var e=a;return a+=t.getWidth(),a+=o?0:r.option("columnPadding",0),e}),l=r.cellX,c=r.option;r.option=function(t,e){var n=c(t,e);return"stackLevel"===t?n+"N":n},t.save(),i.forEach(function(e,a){if(t.save(),t.translate(s[a],0),o){var c=i.slice(0,a);r.cellX=function(t){return l(t)-c.reduce(function(e,r){return e+r.getWidth()*(1-r.getValue(n[t]))},0)}}r.renderCanvas(e,t,n,r),t.restore()}),t.restore(),r.cellX=l,r.option=c},e}(c);e.createRenderer=o;var w=i({colorOf:function(t,e,n){return n.getColor(t)}});e.renderers=a},function(t,e,n){"use strict";function r(){return null}var i=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},o=n(5),a=n(6),s=n(4),l=n(8),c=n(10),u=function(){function t(t){this.desc=t,this.used=0}return t}(),p=function(){function t(t,e,n){void 0===n&&(n={}),this.data=t,this.options={layout:"vertical",elemWidth:100,elemHeight:40,width:100,height:500,additionalDesc:[],hideUsed:!0,addAtEndOnClick:!1},a.merge(this.options,n),this.$node=o.select(e).append("div").classed("lu-pool",!0),this.changeDataStorage(t)}return t.prototype.changeDataStorage=function(t){var e=this;if(this.data&&this.data.on(["addColumn.pool","removeColumn.pool","addRanking.pool","removeRanking.pool","addDesc.pool"],null),this.data=t,this.entries=t.getColumns().concat(this.options.additionalDesc).map(function(t){return new u(t)}),t.on(["addDesc.pool"],function(t){e.entries.push(new u(t)),e.update()}),this.options.hideUsed){var n=this;t.on(["addColumn.pool","removeColumn.pool"],function(t){var e=t.desc,r="addColumn"===this.type?1:-1;n.entries.some(function(t){return t.desc===e&&(t.used+=r,!0)}),n.update()}),t.on(["addRanking.pool","removeRanking.pool"],function(t){var e=t.flatColumns.map(function(t){return t.desc}),r="addRanking"===this.type?1:-1;n.entries.some(function(t){return!(e.indexOf(t.desc)<0)&&(t.used+=r,!0)}),n.update()}),t.getRankings().forEach(function(t){var e=t.flatColumns.map(function(t){return t.desc}),r=1;n.entries.some(function(t){return!(e.indexOf(t.desc)<0)&&void(t.used+=r)})})}},t.prototype.remove=function(){this.$node.remove(),this.data&&this.data.on(["addColumn.pool","removeColumn.pool","addRanking.pool","removeRanking.pool","addDesc.pool"],null)},t.prototype.update=function(){var t=this,e=this.data,n=this.entries.filter(function(t){return 0===t.used}).map(function(t){return t.desc}),r=this.$node.selectAll("div.header").data(n),i=r.enter().append("div").attr({"class":"header",draggable:!0}).on("dragstart",function(t){var n=o.event;n.dataTransfer.effectAllowed="copyMove",n.dataTransfer.setData("text/plain",t.label),n.dataTransfer.setData("application/caleydo-lineup-column",JSON.stringify(e.toDescRef(t))),s.isNumberColumn(t)&&n.dataTransfer.setData("application/caleydo-lineup-column-number",JSON.stringify(e.toDescRef(t)))}).style({width:this.options.elemWidth+"px",height:this.options.elemHeight+"px"});switch(this.options.addAtEndOnClick&&i.on("click",function(e){t.data.push(t.data.getLastRanking(),e)}),i.append("span").classed("label",!0).text(function(t){return t.label}),r.attr("class",function(t){return"header "+(t.cssClass||"")+" "+t.type}),r.style({transform:function(e,n){var r=t.layout(n);return"translate("+r.x+"px,"+r.y+"px)"},"background-color":function(t){var e=t;return e.cssClass?null:e.color||s.Column.DEFAULT_COLOR}}),r.attr({title:function(t){return t.label}}),r.select("span").text(function(t){return t.label}),r.exit().remove(),this.options.layout){case"horizontal":this.$node.style({width:this.options.elemWidth*n.length+"px",height:1*this.options.elemHeight+"px"});break;case"grid":var a=o.round(this.options.width/this.options.elemWidth,0);this.$node.style({width:a*this.options.elemWidth+"px",height:Math.ceil(n.length/a)*this.options.elemHeight+"px"});break;default:this.$node.style({width:1*this.options.elemWidth+"px",height:this.options.elemHeight*n.length+"px"})}},t.prototype.layout=function(t){switch(this.options.layout){case"horizontal":return{x:t*this.options.elemWidth,y:0};case"grid":var e=o.round(this.options.width/this.options.elemWidth,0);return{x:t%e*this.options.elemWidth,y:Math.floor(t/e)*this.options.elemHeight};default:return{x:0,y:t*this.options.elemHeight}}},t}();e.PoolRenderer=p,e.dummyRankingButtonHook=r;var d=function(){function t(t,e,n){var i=this;void 0===n&&(n={}),this.data=t,this.options={slopeWidth:150,columnPadding:5,headerHistogramHeight:40,headerHeight:20,manipulative:!0,histograms:!1,filterDialogs:c.filterDialogs(),linkTemplates:[],searchAble:function(t){return t instanceof s.StringColumn},sortOnLabel:!0,autoRotateLabels:!1,rotationHeight:50,rotationDegree:-20,freezeCols:0,rankingButtons:r},this.histCache=o.map(),this.dragHandler=o.behavior.drag().on("dragstart",function(){o.select(this).classed("dragging",!0),o.event.sourceEvent.stopPropagation(),o.event.sourceEvent.preventDefault()}).on("drag",function(t){var e=Math.max(o.mouse(this.parentNode)[0],2);t.setWidth(e),o.event.sourceEvent.stopPropagation(),o.event.sourceEvent.preventDefault()}).on("dragend",function(t){o.select(this).classed("dragging",!1),o.event.sourceEvent.stopPropagation(),o.event.sourceEvent.preventDefault()}),this.dropHandler=a.dropAble(["application/caleydo-lineup-column-ref","application/caleydo-lineup-column"],function(t,e,n){var r=null;if("application/caleydo-lineup-column-ref"in t){var o=t["application/caleydo-lineup-column-ref"];r=i.data.find(o),n?r=i.data.clone(r):r.removeMe()}else{var a=JSON.parse(t["application/caleydo-lineup-column"]);r=i.data.create(i.data.fromDescRef(a))}if(e instanceof s.Column)return null!=e.insertAfterMe(r);var l=i.data.getLastRanking();return null!==l.push(r)}),a.merge(this.options,n),this.$node=o.select(e).append("div").classed("lu-header",!0),this.$node.append("div").classed("drop",!0).call(this.dropHandler),this.changeDataStorage(t)}return t.prototype.changeDataStorage=function(t){var e=this;this.data&&this.data.on(["dirtyHeader.headerRenderer","orderChanged.headerRenderer","selectionChanged.headerRenderer"],null),this.data=t,t.on("dirtyHeader.headerRenderer",a.delayedCall(this.update.bind(this),1)),this.options.histograms&&(t.on("orderChanged.headerRenderer",function(){e.updateHist(),e.update()}),t.on("selectionChanged.headerRenderer",a.delayedCall(this.drawSelection.bind(this),1)))},Object.defineProperty(t.prototype,"sharedHistCache",{get:function(){return this.histCache},enumerable:!0,configurable:!0}),t.prototype.currentHeight=function(){return parseInt(this.$node.style("height"),10)},t.prototype.updateHist=function(){var t=this,e=this.data.getRankings();e.forEach(function(e){var n=e.getOrder(),r=e.flatColumns,i=null==n?null:t.data.stats(n);r.filter(function(t){return t instanceof s.NumberColumn&&!t.isHidden()}).forEach(function(e){t.histCache.set(e.id,null===i?null:i.stats(e))}),r.filter(function(t){return s.isCategoricalColumn(t)&&!t.isHidden()}).forEach(function(e){t.histCache.set(e.id,null===i?null:i.hist(e))})})},t.prototype.drawSelection=function(){var t=this;if(this.options.histograms){var e=this.$node.node();[].slice.call(e.querySelectorAll("div.bar")).forEach(function(t){return t.classList.remove("selected")});var n=this.data.getSelection();n.length<=0||this.data.view(n).then(function(n){var r=t.data.getRankings();r.forEach(function(t){var r=t.flatColumns;r.filter(function(t){return t instanceof s.NumberColumn&&!t.isHidden()}).forEach(function(t){var r=[].slice.call(e.querySelectorAll('div.header[data-id="'+t.id+'"] div.bar'));n.forEach(function(e){for(var n=t.getValue(e),i=1;i<r.length;++i){var o=r[i];if(o.dataset.x>n){r[i-1].classList.add("selected");break}if(i===r.length-1){o.classList.add("selected");break}}})}),r.filter(function(t){return s.isCategoricalColumn(t)&&!t.isHidden()}).forEach(function(t){var r=e.querySelector('div.header[data-id="'+t.id+'"]');n.forEach(function(e){var n=t.getCategories(e);(n||[]).forEach(function(t){r.querySelector('div.bar[data-cat="'+t+'"]').classList.add("selected")})})})})})}},t.prototype.renderRankingButtons=function(t,e){var n=this.$node.selectAll("div.rankingbuttons").data(t);n.enter().append("div").classed("rankingbuttons",!0).call(this.options.rankingButtons),n.style("left",function(t,n){return e[n]+"px"}),n.exit().remove()},t.prototype.update=function(){function t(e){return e instanceof s.StackColumn&&!e.getCollapsed()&&!e.getCompressed()?1+Math.max.apply(Math,e.children.map(t)):1}var e=this,n=this,i=this.data.getRankings(),a=[],l=0,c=[];i.forEach(function(t){l+=t.flatten(a,l,1,e.options.columnPadding)+e.options.slopeWidth,c.push(l-e.options.slopeWidth)}),l-=this.options.slopeWidth;var u=a.map(function(t){return t.col});this.options.histograms&&this.histCache.empty()&&i.length>0&&this.updateHist(),this.renderColumns(u,a),this.options.rankingButtons!==r&&this.renderRankingButtons(i,c);var p=Math.max.apply(Math,u.map(t)),d=(this.options.histograms?this.options.headerHistogramHeight:this.options.headerHeight)+(p-1)*this.options.headerHeight;if(this.options.autoRotateLabels){var h=!1;this.$node.selectAll("div.header").style("height",d+"px").select("div.lu-label").each(function(t){var e=this.querySelector("span.lu-label").offsetWidth,r=t.getWidth();e>r+30?(o.select(this).style("transform","rotate("+n.options.rotationDegree+"deg)"),h=!0):o.select(this).style("transform",null)}),this.$node.selectAll("div.header").style("margin-top",h?this.options.rotationHeight+"px":null),d+=h?this.options.rotationHeight:0}this.$node.style("height",d+"px")},t.prototype.createToolbar=function(t){var e=this,n=this.options.filterDialogs,r=this.data,i=this,a=t.filter(function(t){return!(t instanceof s.Ranking)}),l=t.filter(function(t){return t instanceof s.StackColumn});l.append("i").attr("class","fa fa-tasks").attr("title","Edit Weights").on("click",function(t){c.openEditWeightsDialog(t,o.select(this.parentNode.parentNode)),o.event.stopPropagation()}),a.append("i").attr("class","fa fa-pencil-square-o").attr("title","Rename").on("click",function(t){c.openRenameDialog(t,o.select(this.parentNode.parentNode)),o.event.stopPropagation()}),a.append("i").attr("class","fa fa-code-fork").attr("title","Generate Snapshot").on("click",function(t){r.takeSnapshot(t),o.event.stopPropagation()}),t.filter(function(t){return t instanceof s.LinkColumn}).append("i").attr("class","fa fa-external-link").attr("title","Edit Link Pattern").on("click",function(t){c.openEditLinkDialog(t,o.select(this.parentNode.parentNode),[].concat(t.desc.templates||[],i.options.linkTemplates)),o.event.stopPropagation()}),t.filter(function(t){return t instanceof s.ScriptColumn}).append("i").attr("class","fa fa-gears").attr("title","Edit Combine Script").on("click",function(t){c.openEditScriptDialog(t,o.select(this.parentNode.parentNode)),o.event.stopPropagation()}),t.filter(function(t){return n.hasOwnProperty(t.desc.type)}).append("i").attr("class","fa fa-filter").attr("title","Filter").on("click",function(t){n[t.desc.type](t,o.select(this.parentNode.parentNode),r),o.event.stopPropagation()}),t.filter(function(t){return e.options.searchAble(t)}).append("i").attr("class","fa fa-search").attr("title","Search").on("click",function(t){c.openSearchDialog(t,o.select(this.parentNode.parentNode),r),o.event.stopPropagation()}),a.append("i").attr("class","fa").classed("fa-toggle-left",function(t){return!t.getCompressed()}).classed("fa-toggle-right",function(t){return t.getCompressed()}).attr("title","(Un)Collapse").on("click",function(t){t.setCompressed(!t.getCompressed()),o.select(this).classed("fa-toggle-left",!t.getCompressed()).classed("fa-toggle-right",t.getCompressed()),o.event.stopPropagation()}),l.append("i").attr("class","fa").classed("fa-compress",function(t){return!t.getCollapsed()}).classed("fa-expand",function(t){return t.getCollapsed()}).attr("title","Compress/Expand").on("click",function(t){t.setCollapsed(!t.getCollapsed()),o.select(this).classed("fa-compress",!t.getCollapsed()).classed("fa-expand",t.getCollapsed()),o.event.stopPropagation()}),t.append("i").attr("class","fa fa-times").attr("title","Hide").on("click",function(t){t instanceof s.RankColumn?(r.removeRanking(t.findMyRanker()),0===r.getRankings().length&&r.pushRanking()):t.removeMe(),o.event.stopPropagation()})},t.prototype.updateFreeze=function(t){var e=this.options.freezeCols;this.$node.selectAll("div.header").style("z-index",function(t,n){return n<e?1:null}).style("transform",function(n,r){return r<e?"translate("+t+"px,0)":null})},t.prototype.renderColumns=function(t,e,n,r){var i=this;void 0===n&&(n=this.$node),void 0===r&&(r="header");var l=n.selectAll("div."+r).data(t,function(t){return t.id}),c=l.enter().append("div").attr({"class":r}).on("click",function(t){i.options.manipulative&&!o.event.defaultPrevented&&o.event.currentTarget===o.event.target&&t.toggleMySorting()}),u=c.append("div").classed("lu-label",!0).on("click",function(t){i.options.manipulative&&!o.event.defaultPrevented&&t.toggleMySorting()}).on("dragstart",function(t){var e=o.event;e.dataTransfer.effectAllowed="copyMove",e.dataTransfer.setData("text/plain",t.label),e.dataTransfer.setData("application/caleydo-lineup-column-ref",t.id);var n=JSON.stringify(i.data.toDescRef(t.desc));e.dataTransfer.setData("application/caleydo-lineup-column",n),s.isNumberColumn(t)&&(e.dataTransfer.setData("application/caleydo-lineup-column-number",n),e.dataTransfer.setData("application/caleydo-lineup-column-number-ref",t.id))});u.append("i").attr("class","fa fa sort_indicator"),u.append("span").classed("lu-label",!0).attr({draggable:this.options.manipulative}),this.options.manipulative&&(c.append("div").classed("handle",!0).call(this.dragHandler).style("width",this.options.columnPadding+"px").call(this.dropHandler),c.append("div").classed("toolbar",!0).call(this.createToolbar.bind(this))),this.options.histograms&&c.append("div").classed("histogram",!0),l.style({width:function(t,n){return e[n].width+i.options.columnPadding+"px"},left:function(t,n){return e[n].offset+"px"},"background-color":function(t){return t.color}}),l.attr({"class":function(t){return r+" "+(t.cssClass||"")+" "+(t.getCompressed()?"compressed":"")+" "+t.headerCssClass+" "+(i.options.autoRotateLabels?"rotateable":"")+" "+(t.isFiltered()?"filtered":"")},title:function(t){return t.label},"data-id":function(t){return t.id}}),l.select("i.sort_indicator").attr("class",function(t){var e=t.findMyRanker();return e&&e.getSortCriteria().col===t?"sort_indicator fa fa-sort-"+(e.getSortCriteria().asc?"asc":"desc"):"sort_indicator fa"}),l.select("span.lu-label").text(function(t){return t.label});var p=this;l.filter(function(t){return t instanceof s.StackColumn}).each(function(t){if(t.getCollapsed()||t.getCompressed())o.select(this).selectAll("div."+r+"_i").remove();else{var e=[];t.flatten(e,0,1,p.options.columnPadding);var n=e.map(function(t){return t.col});p.renderColumns(n,e,o.select(this),r+("_i"!==r.substr(r.length-2)?"_i":""))}}).select("div.lu-label").call(a.dropAble(["application/caleydo-lineup-column-number-ref","application/caleydo-lineup-column-number"],function(t,e,n){var r=null;if("application/caleydo-lineup-column-number-ref"in t){var o=t["application/caleydo-lineup-column-number-ref"];r=i.data.find(o),n?r=i.data.clone(r):r&&r.removeMe()}else{var a=JSON.parse(t["application/caleydo-lineup-column-number"]);r=i.data.create(i.data.fromDescRef(a))}return null!=e.push(r)})),this.options.histograms&&(l.filter(function(t){return s.isCategoricalColumn(t)}).each(function(t){var e=o.select(this).select("div.histogram"),n=p.histCache.get(t.id);n&&n.then(function(n){var r=e.selectAll("div.bar").data(n.hist);r.enter().append("div").classed("bar",!0);var i=o.scale.ordinal().domain(t.categories).rangeBands([0,100],.1),a=o.scale.linear().domain([0,n.maxBin]).range([0,100]);r.style({left:function(t){return i(t.cat)+"%"},width:function(t){return i.rangeBand()+"%"},top:function(t){return 100-a(t.y)+"%"},height:function(t){return a(t.y)+"%"},"background-color":function(e){return t.colorOf(e.cat)}}).attr({title:function(t){return t.cat+": "+t.y},"data-cat":function(t){return t.cat}}),r.exit().remove()})}),l.filter(function(t){return t instanceof s.NumberColumn}).each(function(t){var e=o.select(this).select("div.histogram"),n=p.histCache.get(t.id);n&&n.then(function(t){var n=e.selectAll("div.bar").data(t.hist);n.enter().append("div").classed("bar",!0);var r=o.scale.ordinal().domain(o.range(t.hist.length).map(String)).rangeBands([0,100],.1),i=o.scale.linear().domain([0,t.maxBin]).range([0,100]);n.style({left:function(t,e){return r(String(e))+"%"},width:function(t,e){return r.rangeBand()+"%"},top:function(t){return 100-i(t.y)+"%"},height:function(t){return i(t.y)+"%"}}).attr({title:function(t,e){return"Bin "+e+": "+t.y},"data-x":function(t){return t.x}}),n.exit().remove();var a=e.select("div.mean");a.empty()&&(a=e.append("div").classed("mean",!0)),a.style("left",100*t.mean+"%")})})),l.exit().remove()},t}();e.HeaderRenderer=d;var h=function(t){function e(e,n,r,i){void 0===i&&(i={}),t.call(this),this.data=e,this.slicer=r,this.options={rowHeight:20,rowPadding:1,rowBarPadding:1,idPrefix:"",slopeWidth:150,columnPadding:5,stacked:!0,animation:!1,animationDuration:1e3,renderers:l.renderers(),meanLine:!1,actions:[],freezeCols:0},this.currentFreezeLeft=0,this.histCache=o.map(),a.merge(this.options,i),this.$node=o.select(n).append("svg").classed("lu-body",!0),this.changeDataStorage(e)}return i(e,t),e.prototype.createEventList=function(){return t.prototype.createEventList.call(this).concat(["hoverChanged","renderFinished"])},Object.defineProperty(e.prototype,"node",{get:function(){return this.$node.node()},enumerable:!0,configurable:!0}),e.prototype.setOption=function(t,e){this.options[t]=e},e.prototype.changeDataStorage=function(t){this.data&&this.data.on(["dirtyValues.bodyRenderer","selectionChanged.bodyRenderer"],null),this.data=t,t.on("dirtyValues.bodyRenderer",a.delayedCall(this.update.bind(this),1)),t.on("selectionChanged.bodyRenderer",a.delayedCall(this.drawSelection.bind(this),1))},e.prototype.createContext=function(t){var e=this.options;return{rowKey:this.options.animation?this.data.rowKey:void 0,cellY:function(n){return(n+t)*e.rowHeight},cellPrevY:function(n){return(n+t)*e.rowHeight},cellX:function(t){return 0},rowHeight:function(t){return e.rowHeight*(1-e.rowPadding)},renderer:function(t){if(t.getCompressed()&&s.isNumberColumn(t))return e.renderers.heatmap;if(t instanceof s.StackColumn&&t.getCollapsed())return e.renderers.number;var n=e.renderers[t.desc.type];return n||l.defaultRenderer()},render:function(t,e,n,r){void 0===r&&(r=this);var i=e.node(),o=i.__renderer__,a=this.renderer(t);o!==a&&(e.selectAll("*").remove(),i.__renderer__=a),a.render(e,t,n,r)},renderCanvas:function(t,e,n,r){void 0===r&&(r=this)},showStacked:function(t){return e.stacked},idPrefix:e.idPrefix,animated:function(t){return e.animation?t.transition().duration(e.animationDuration):t},showMeanLine:function(t){return e.meanLine&&s.isNumberColumn(t)&&!t.getCompressed()&&t.parent instanceof s.Ranking},option:function(t,n){return t in e?e[t]:n}}},e.prototype.updateClipPathsImpl=function(t,e,n){var r=this.$node.select("defs.body");r.empty()&&(r=this.$node.append("defs").classed("body",!0));var i=r.selectAll(function(){return this.getElementsByTagName("clipPath")}).data(t,function(t){return t.id});i.enter().append("clipPath").attr("id",function(t){return e.idPrefix+"clipCol"+t.id}).append("rect").attr({y:0}),i.exit().remove(),i.select("rect").attr({x:0,width:function(t){return Math.max(t.getWidth()-5,0)},height:n})},e.prototype.updateClipPaths=function(t,e,n){var r=this,i=[],o=0;t.forEach(function(t){var e=t.flatten(i,o,2,r.options.columnPadding);o+=e+r.options.slopeWidth}),this.updateClipPathsImpl(i.map(function(t){return t.col}),e,n);var a=this.$node.select("clipPath#c"+e.idPrefix+"Freeze");a.empty()&&(a=this.$node.append("clipPath").attr("id","c"+e.idPrefix+"Freeze").append("rect").attr({y:0,width:2e4,height:n})),a.select("rect").attr({height:n})},e.prototype.renderRankings=function(t,e,n,r,i,a){function s(t,e,n,a,s){t.classed("hover",!0);var l=t.select("g.values").selectAll("g.uchild").data(a.children.filter(function(t){return!t.isHidden()}),function(t){return t.id});l.enter().append("g").attr({"class":"uchild"}).append("g").classed("child",!0),l.select("g.child").attr({transform:function(t,e){return"translate("+r[s].shifts[e]+",0)"}}).each(function(t,r){var a=this;p[s].then(function(s){i.renderer(t).mouseEnter(e.selectAll('g.child[data-index="'+r+'"]'),o.select(a),t,s[n],n,i)})}),l.exit().remove()}function l(t,e,n,r,a){t.classed("hover",!1),t.select("g.values").selectAll("g.uchild").each(function(t,r){var s=this;p[a].then(function(a){i.renderer(t).mouseLeave(e.selectAll('g.child[data-index="'+r+'"]'),o.select(s).select("g.child"),t,a[n],n,i)})}).remove()}var c=this,u=this,p=n.map(function(t){return c.data.view(t)}),d=t.selectAll("g.ranking").data(e,function(t){return t.id}),h=d.enter().append("g").attr({"class":"ranking",transform:function(t,e){return"translate("+r[e].shift+",0)"}});h.append("g").attr("class","rows"),h.append("g").attr("class","cols"),i.animated(d).attr({transform:function(t,e){return"translate("+r[e].shift+",0)"}});var f=d.select("g.cols").selectAll("g.uchild").data(function(t){return t.children.filter(function(t){return!t.isHidden()})},function(t){return t.id});f.enter().append("g").attr("class","uchild").append("g").attr({"class":"child",transform:function(t,e,n){return"translate("+r[n].shifts[e]+",0)"}}),f.exit().remove(),f=f.select("g.child"),f.attr({"data-index":function(t,e){return e}}),i.animated(f).attr({transform:function(t,e,n){return"translate("+r[n].shifts[e]+",0)";
}}).each(function(t,e,n){var r=o.select(this);if(p[n].then(function(e){i.render(t,r,e,i)}),i.showMeanLine(t)){var s=u.histCache.get(t.id);s&&s.then(function(e){var n=r.selectAll("line.meanline").data([e.mean]);n.enter().append("line").attr("class","meanline"),n.exit().remove(),n.attr("x1",t.getWidth()*e.mean).attr("x2",t.getWidth()*e.mean).attr("y2",a)})}else r.selectAll("line.meanline").remove()}),Promise.all(p).then(function(t){c.fire("renderFinished")}),this.mouseOverItem=function(t,e){void 0===e&&(e=!0),d.each(function(n,r){var i=o.select(this),a=i.selectAll('g.row[data-index="'+t+'"]'),c=i.select("g.cols");if(!a.empty()){var u=a.datum().i;e?s(a,c,u,n,r):l(a,c,u,n,r)}}),u.updateFrozenRows()};var g=d.select("g.rows").selectAll("g.row").data(function(t,e){return n[e].map(function(t,e){return{d:t,i:e}})}),m=g.enter().append("g").attr({"class":"row"});m.append("rect").attr({"class":"bg"}),m.append("g").attr({"class":"values"}),m.on("mouseenter",function(t){c.mouseOver(t.d,!0)}).on("mouseleave",function(t){c.mouseOver(t.d,!1)}).on("click",function(t){c.select(t.d,o.event.ctrlKey)}),g.attr({"data-index":function(t){return t.d}}).classed("selected",function(t){return c.data.isSelected(t.d)}),g.select("rect").attr({y:function(t){return i.cellY(t.i)},height:function(t){return i.rowHeight(t.i)},width:function(t,e,n){return r[n].width},"class":function(t,e){return"bg "+(e%2===0?"even":"odd")}}),g.exit().remove(),d.exit().remove()},e.prototype.select=function(t,e){void 0===e&&(e=!1);var n=this.data.toggleSelection(t,e);this.$node.selectAll('g.row[data-index="'+t+'"], line.slope[data-index="'+t+'"]').classed("selected",n)},e.prototype.hasAnySelectionColumn=function(){return this.data.getRankings().some(function(t){return t.children.some(function(t){return t instanceof s.SelectionColumn&&!t.isHidden()})})},e.prototype.drawSelection=function(){this.hasAnySelectionColumn()&&this.update();var t=this.data.getSelection();if(0===t.length)this.$node.selectAll("g.row.selected, line.slope.selected").classed("selected",!1);else{var e=o.set(t);this.$node.selectAll("g.row").classed("selected",function(t){return e.has(String(t.d))}),this.$node.selectAll("line.slope").classed("selected",function(t){return e.has(String(t.data_index))})}},e.prototype.mouseOver=function(t,e){void 0===e&&(e=!0),this.fire("hoverChanged",e?t:-1),this.mouseOverItem(t,e),this.$node.selectAll('line.slope[data-index="'+t+'"]').classed("hover",e)},e.prototype.renderSlopeGraphs=function(t,e,n,r,i){var o=this,a=n.slice(1).map(function(t,e){return{left:n[e],left_i:e,right:t,right_i:e+1}}),s=t.selectAll("g.slopegraph").data(a);s.enter().append("g").attr({"class":"slopegraph"}),s.attr({transform:function(t,e){return"translate("+(r[e+1].shift-o.options.slopeWidth)+",0)"}});var l=s.selectAll("line.slope").data(function(t,e){var n={};return t.right.forEach(function(t,e){n[t]=e}),t.left.map(function(t,e){return{data_index:t,lpos:e,rpos:n[t]}}).filter(function(t){return null!=t.rpos})});l.enter().append("line").attr({"class":"slope",x2:this.options.slopeWidth}).on("mouseenter",function(t){o.mouseOver(t.data_index,!0)}).on("mouseleave",function(t){o.mouseOver(t.data_index,!1)}),l.attr({"data-index":function(t){return t.data_index}}),l.attr({y1:function(t){return.5*i.rowHeight(t.lpos)+i.cellY(t.lpos)},y2:function(t){return.5*i.rowHeight(t.rpos)+i.cellY(t.rpos)}}),l.exit().remove(),s.exit().remove()},e.prototype.updateFreeze=function(t){var e=this,n=this.options.freezeCols,r=this.$node.select("g.cols"),i=this.$node.select("#c"+this.options.idPrefix+"Freeze").select("rect"),a=r.select('g.child[data-index="'+n+'"]');a.empty()&&(a=r.select("g.child:last-of-type"));var s=o.transform(a.attr("transform")||"").translate[0];i.attr("x",t+s),r.selectAll("g.uchild").attr({"clip-path":function(t,r){return r<n?null:"url(#c"+e.options.idPrefix+"Freeze)"},transform:function(e,r){return r<n?"translate("+t+",0)":null}}),this.currentFreezeLeft=t,this.updateFrozenRows()},e.prototype.updateFrozenRows=function(){var t=this,e=this.options.freezeCols;if(!(e<=0)){var n=this.currentFreezeLeft,r=this.$node.select("g.rows");r.select("g.row.hover g.values").selectAll("g.uchild").attr({"clip-path":function(n,r){return r<e?null:"url(#c"+t.options.idPrefix+"Freeze)"},transform:function(t,r){return r<e?"translate("+n+",0)":null}})}},e.prototype.update=function(){var t=this,e=this.data.getRankings(),n=o.max(e,function(t){return t.getOrder().length})||0,r=this.options.rowHeight*n,i=this.slicer(0,n,function(e){return e*t.options.rowHeight}),a=function(t){return 0===i.from&&t.length<=i.to?t:t.slice(i.from,Math.min(t.length,i.to))},l=e.map(function(t){return a(t.getOrder())}),c=this.createContext(i.from),u=0,p=e.map(function(e,n){var r=u;u+=t.options.slopeWidth;var i=0,o=e.children.filter(function(t){return!t.isHidden()}).map(function(e){var n=i;return i+=(e.getCompressed()?s.Column.COMPRESSED_WIDTH:e.getWidth())+t.options.columnPadding,e instanceof s.StackColumn&&!e.getCollapsed()&&!e.getCompressed()&&(i+=t.options.columnPadding*(e.length-1)),n});return u+=i,{shift:r,shifts:o,width:i}});this.$node.attr({width:Math.max(0,u-this.options.slopeWidth),height:r}),this.updateClipPaths(e,c,r);var d=this.$node.select("g.body");d.empty()&&(d=this.$node.append("g").classed("body",!0)),this.renderRankings(d,e,l,p,c,r),this.renderSlopeGraphs(d,e,l,p,c)},e}(a.AEventDispatcher);e.BodyRenderer=h;var f=function(t){function e(e,n,r,i){void 0===i&&(i={}),t.call(this),this.data=e,this.slicer=r,this.options={rowHeight:20,rowPadding:1,rowBarPadding:1,idPrefix:"",slopeWidth:150,columnPadding:5,stacked:!0,renderers:l.renderers(),meanLine:!1,freezeCols:0},this.histCache=o.map(),a.merge(this.options,i),this.$node=o.select(n).append("canvas").classed("lu-canvas.body",!0),this.changeDataStorage(e)}return i(e,t),e.prototype.createEventList=function(){return t.prototype.createEventList.call(this).concat(["hoverChanged"])},Object.defineProperty(e.prototype,"node",{get:function(){return this.$node.node()},enumerable:!0,configurable:!0}),e.prototype.setOption=function(t,e){this.options[t]=e},e.prototype.updateFreeze=function(t){},e.prototype.select=function(t,e){void 0===e&&(e=!1)},e.prototype.changeDataStorage=function(t){this.data&&this.data.on(["dirtyValues.bodyRenderer","selectionChanged.bodyRenderer"],null),this.data=t,t.on("dirtyValues.bodyRenderer",a.delayedCall(this.update.bind(this),1))},e.prototype.createContext=function(t){var e=this.options;return{rowKey:void 0,cellY:function(n){return(n+t)*e.rowHeight},cellPrevY:function(n){return(n+t)*e.rowHeight},cellX:function(t){return 0},rowHeight:function(t){return e.rowHeight*(1-e.rowPadding)},renderer:function(t){if(t.getCompressed()&&s.isNumberColumn(t))return e.renderers.heatmap;if(t instanceof s.StackColumn&&t.getCollapsed())return e.renderers.number;var n=e.renderers[t.desc.type];return n||l.defaultRenderer()},render:function(t,e,n,r){void 0===r&&(r=this)},renderCanvas:function(t,e,n,r){void 0===r&&(r=this);var i=this.renderer(t);i.renderCanvas(e,t,n,r)},showStacked:function(t){return e.stacked},idPrefix:e.idPrefix,animated:function(t){return t},showMeanLine:function(t){return e.meanLine&&s.isNumberColumn(t)&&!t.getCompressed()&&t.parent instanceof s.Ranking},option:function(t,n){return t in e?e[t]:n}}},e.prototype.renderRankings=function(t,e,n,r,i,o){var a=this,s=n.map(function(t){return a.data.view(t)});t.save(),e.forEach(function(e,o){s[o].then(function(a){t.save(),t.translate(r[o].shift,0),t.save(),t.fillStyle="#f7f7f7",n[o].forEach(function(e,n){n%2===0&&t.fillRect(0,i.cellY(n),r[o].width,i.rowHeight(n))}),t.restore(),e.children.forEach(function(e,n){t.save(),t.translate(r[o].shifts[n],0),i.renderCanvas(e,t,a,i),t.restore()}),t.restore()})}),t.restore()},e.prototype.renderSlopeGraphs=function(t,e,n,r,i){var o=this,a=n.slice(1).map(function(t,e){return{left:n[e],left_i:e,right:t,right_i:e+1}});t.save(),t.fillStyle="darkgray",a.forEach(function(e,n){t.save(),t.translate(r[n+1].shift-o.options.slopeWidth,0);var a={};e.right.forEach(function(t,e){a[t]=e});var s=e.left.map(function(t,e){return{data_index:t,lpos:e,rpos:a[t]}}).filter(function(t){return null!=t.rpos});t.beginPath(),s.forEach(function(e){t.moveTo(0,.5*i.rowHeight(e.lpos)+i.cellY(e.lpos)),t.lineTo(o.options.slopeWidth,.5*i.rowHeight(e.rpos)+i.cellY(e.rpos))}),t.stroke(),t.restore()}),t.restore()},e.prototype.update=function(){var t=this,e=this.data.getRankings(),n=o.max(e,function(t){return t.getOrder().length})||0,r=this.options.rowHeight*n,i=this.slicer(0,n,function(e){return e*t.options.rowHeight}),a=function(t){return 0===i.from&&t.length<=i.to?t:t.slice(i.from,Math.min(t.length,i.to))},l=e.map(function(t){return a(t.getOrder())}),c=this.createContext(i.from),u=0,p=e.map(function(e,n){var r=u;u+=t.options.slopeWidth;var i=0,o=e.children.filter(function(t){return!t.isHidden()}).map(function(e){var n=i;return i+=(e.getCompressed()?s.Column.COMPRESSED_WIDTH:e.getWidth())+t.options.columnPadding,e instanceof s.StackColumn&&!e.getCollapsed()&&!e.getCompressed()&&(i+=t.options.columnPadding*(e.length-1)),n});return u+=i,{shift:r,shifts:o,width:i}});this.$node.attr({width:u,height:r});var d=this.$node.node().getContext("2d");d.font="10pt Times New Roman",d.textBaseline="top",d.clearRect(0,0,d.canvas.width,d.canvas.height),this.renderRankings(d,e,l,p,c,r),this.renderSlopeGraphs(d,e,l,p,c)},e}(a.AEventDispatcher);e.BodyCanvasRenderer=f},function(t,e,n){"use strict";function r(t,e,n){return void 0===n&&(n=!1),'<span style="font-weight: bold">'+t+'</span><form onsubmit="return false">'+e+'<button type = "submit" class="ok fa fa-check" title="ok"></button><button type = "reset" class="cancel fa fa-times" title="cancel"></button><button type = "button" class="reset fa fa-undo" title="reset"></button></form>'}function i(t,e,n){var i=v.offset(t.node()),o=d3.select("body").append("div").attr({"class":"lu-popup2"}).style({left:i.left+"px",top:i.top+"px"}).html(r(e,n));o.on("keydown",function(){27===d3.event.which&&o.remove()});var a=o.select("input[autofocus]").node();return a&&a.focus(),o}function o(t,e){var n=i(e,"Rename Column",'<input type="text" size="15" value="'+t.label+'" required="required" autofocus="autofocus"><br><input type="color" size="15" value="'+t.color+'" required="required"><br>');n.select(".ok").on("click",function(){var e=n.select('input[type="text"]').property("value"),r=n.select('input[type="color"]').property("value");t.setMetaData({label:e,color:r}),n.remove()}),n.select(".cancel").on("click",function(){n.remove()})}function a(t,e,n){void 0===n&&(n=[]);var r='<input type="text" size="15" value="'+t.getLink()+'" required="required" autofocus="autofocus" '+(n.length>0?'list="lineupPatternList"':"")+"><br>";n.length>0&&(r+='<datalist id="lineupPatternList">'+n.map(function(t){return'<option value="'+t+'">'})+"</datalist>");var o=i(e,"Edit Link ($ as Placeholder)",r);o.select(".ok").on("click",function(){var e=o.select('input[type="text"]').property("value");t.setLink(e),o.remove()}),o.select(".cancel").on("click",function(){o.remove()})}function s(t,e,n){function r(){var e=o.select('input[type="text"]').property("value"),r=o.select('input[type="text"]').property("checked");e.length>0&&(r&&(e=new RegExp(e)),n.searchSelect(e,t)),o.remove()}var o=i(e,"Search",'<input type="text" size="15" value="" required="required" autofocus="autofocus"><br><label><input type="checkbox">RegExp</label><br>');o.select('input[type="text"]').on("input",function(){var e=d3.event.target.value;if(e.length>=3){var r=o.select('input[type="checkbox"]').property("checked");r&&(e=new RegExp(e)),n.searchSelect(e,t)}}),o.select('input[type="checkbox"]').on("change",r),o.select(".ok").on("click",r),o.select(".cancel").on("click",function(){o.remove()})}function l(t,e){function n(){l.select(".bar").transition().style("width",function(t){return a(t.weight)+"px"})}var r=t.getWeights(),o=t.children.map(function(t,e){return{col:t,weight:100*r[e]}}),a=d3.scale.linear().domain([0,100]).range([0,120]),s=i(e,"Edit Weights","<table></table>"),l=s.select("table").selectAll("tr").data(o),c=l.enter().append("tr");c.append("td").append("input").attr({type:"number",value:function(t){return t.weight},min:0,max:100,size:5}).on("input",function(t){t.weight=+this.value,n()}),c.append("td").append("div").attr("class",function(t){return"bar "+t.col.cssClass}).style("background-color",function(t){return t.col.color}),c.append("td").text(function(t){return t.col.label}),n(),s.select(".cancel").on("click",function(){t.setWeights(r),s.remove()}),s.select(".reset").on("click",function(){o.forEach(function(t,e){return t.weight=100*r[e]}),l.select("input").property("value",function(t){return t.weight}),n()}),s.select(".ok").on("click",function(){t.setWeights(o.map(function(t){return t.weight})),s.remove()})}function c(t,e){void 0===e&&(e=!1),t.classed("filtered",e)}function u(t,e){function n(){var t=s.select("tbody").selectAll("tr").data(l);t.select(".checkmark").html(function(t){return'<i class="fa fa-'+(t.isChecked?"check-":"")+'square-o"></i>'}),t.on("click",function(t){t.isChecked=!t.isChecked,n()}),t.select(".datalabel").style("opacity",function(t){return t.isChecked?"1.0":".8"})}function r(){s.select(".selectAll").html(function(t){return'<i class="fa fa-'+(p?"check-":"")+'square-o"></i>'}),s.select("thead").on("click",function(t){p=!p,l.map(function(t){t.isChecked=p}),n(),r()})}function o(n){c(e,n&&n.length>0&&n.length<t.categories.length),t.setFilter(n)}var a=t.getFilter()||[],s=i(e,"Edit Filter",'<div class="selectionTable"><table><thead><th class="selectAll"></th><th>Category</th></thead><tbody></tbody></table></div>'),l=t.categories.map(function(t){return{d:t,isChecked:0===a.length||a.indexOf(t)>=0}}).sort(function(t,e){return t.d.toLowerCase()<e.d.toLowerCase()?-1:t.d.toLowerCase()>e.d.toLowerCase()?1:0}),u=s.select("tbody").selectAll("tr").data(l);u.enter().append("tr"),u.append("td").attr("class","checkmark"),u.append("td").attr("class","datalabel").text(function(t){return t.d}),n();var p=!0;r(),s.select(".cancel").on("click",function(){o(a),s.remove()}),s.select(".reset").on("click",function(){l.forEach(function(t){return t.isChecked=!0}),n(),o(null)}),s.select(".ok").on("click",function(){var e=l.filter(function(t){return t.isChecked}).map(function(t){return t.d});e.length===t.categories.length&&(e=[]),o(e),s.remove()})}function p(t,e){function n(n){c(e,n&&""!==n),t.setFilter(n)}function r(t){var e=a.select('input[type="text"]').property("value");if(e.length>=3||t){var r=a.select('input[type="checkbox"]').property("checked");r&&(e=new RegExp(e)),n(e)}}var o=t.getFilter()||"",a=i(e,"Filter",'<input type="text" placeholder="containing..." autofocus="true" size="15" value="'+(o instanceof RegExp?o.source:o)+'" autofocus="autofocus">\n    <br><label><input type="checkbox" '+(o instanceof RegExp?'checked="checked"':"")+">RegExp</label>\n    <br>");a.select('input[type="checkbox"]').on("change",r),a.select('input[type="text"]').on("input",r),a.select(".cancel").on("click",function(){a.select('input[type="text"]').property("value",o),a.select('input[type="checkbox"]').property("checked",o instanceof RegExp?"checked":null),n(o),a.remove()}),a.select(".reset").on("click",function(){a.select('input[type="text"]').property("value",""),a.select('input[type="checkbox"]').property("checked",null),n(null)}),a.select(".ok").on("click",function(){r(!0),a.remove()})}function d(t,e){function n(n){c(e,null!==n),t.setFilter(n)}function r(t){var e=a.select('input[type="radio"][value="true"]').property("checked"),r=a.select('input[type="radio"][value="false"]').property("checked");n(!!e||!r&&null)}var o=t.getFilter(),a=i(e,"Filter",'<label><input type="radio" name="boolean_check" value="null" '+(null===o?'checked="checked"':"")+'>No Filter</label><br>\n     <label><input type="radio" name="boolean_check" value="true" '+(o===!0?'checked="checked"':"")+'>True</label><br>\n     <label><input type="radio" name="boolean_check" value="false" '+(o===!1?'checked="checked"':"")+">False</label>\n    <br>");a.selectAll('input[type="radio"]').on("change",r),a.select(".cancel").on("click",function(){n(o),a.remove()}),a.select(".reset").on("click",function(){var t=null===o?"null":String(o);a.selectAll('input[type="radio"]').property("checked",function(){return this.value===t}),n(null)}),a.select(".ok").on("click",function(){r(!0),a.remove()})}function h(t,e){function n(e){t.setScript(e)}function r(){var t=a.select("textarea").property("value");n(t)}var o=t.getScript(),a=i(e,"Edit Script",'Parameters: <code>values: number[], children: Column[]</code><br>\n      <textarea autofocus="true" rows="5" autofocus="autofocus" style="width: 95%;">'+t.getScript()+"</textarea><br>");a.select(".cancel").on("click",function(){a.select("textarea").property("value",o),n(o),a.remove()}),a.select(".reset").on("click",function(){a.select("textarea").property("value",y.ScriptColumn.DEFAULT_SCRIPT),n(y.ScriptColumn.DEFAULT_SCRIPT)}),a.select(".ok").on("click",function(){r(),a.remove()})}function f(t,e,n){function i(n){l=n,c(e,!n.eq(s)),t.setMapping(n);var r=p.property("checked");r?t.setFilter({min:n.domain[0],max:n.domain[1]}):t.setFilter()}var o=v.offset(e.node()),a=t.getMapping(),s=t.getOriginalMapping(),l=a.clone(),u=d3.select("body").append("div").attr({"class":"lu-popup"}).style({left:o.left+"px",top:o.top+"px"}).html(r("Change Mapping",'<div class="mappingArea"></div><label><input type="checkbox" id="filterIt" value="filterIt">Filter Outliers</label><br>')),p=u.select("input").on("change",function(){i(l)});p.property("checked",t.isFiltered());var d={callback:i,triggerCallback:"dragend"},h=n.mappingSample(t),f=b.create(u.select(".mappingArea").node(),l,s,h,d);u.select(".ok").on("click",function(){i(f.scale),u.remove()}),u.select(".cancel").on("click",function(){t.setMapping(a),c(e,!a.eq(s)),u.remove()}),u.select(".reset").on("click",function(){a=s,l=a.clone(),i(l),u.selectAll(".mappingArea *").remove(),f=b.create(u.select(".mappingArea").node(),l,s,h,d)})}function g(t,e){function n(){c.select(".bar").transition().style({width:function(t){return s(t.range)+"px"}})}var r=t.getScale().range,o=t.categoryColors,a=t.categories.map(function(t,e){return{cat:t,range:100*r[e],color:o[e]}}),s=d3.scale.linear().domain([0,100]).range([0,120]),l=i(e,"Edit Categorical Mapping","<table></table>"),c=l.select("table").selectAll("tr").data(a),u=c.enter().append("tr");u.append("td").append("input").attr({type:"number",value:function(t){return t.range},min:0,max:100,size:5}).on("input",function(t){t.range=+this.value,n()}),u.append("td").append("div").attr("class","bar").style("background-color",function(t){return t.color}),u.append("td").text(function(t){return t.cat}),n(),l.select(".cancel").on("click",function(){t.setMapping(r),l.remove()}),l.select(".ok").on("click",function(){t.setMapping(a.map(function(t){return t.range/100})),l.remove()})}function m(){return{string:p,categorical:u,number:f,ordinal:g,"boolean":d}}var y=n(4),v=n(6),b=n(11);e.dialogForm=r,e.makePopup=i,e.openRenameDialog=o,e.openEditLinkDialog=a,e.openSearchDialog=s,e.openEditWeightsDialog=l,e.openEditScriptDialog=h,e.filterDialogs=m},function(t,e,n){"use strict";function r(t,e,n){return Math.max(Math.min(t,n),e)}function i(t,e,n,r,i){return void 0===i&&(i={}),new l(t,e,n,r,i)}var o=n(5),a=n(6),s=n(4),l=function(){function t(t,e,n,r,i){void 0===i&&(i={}),this.parent=t,this.scale_=e,this.original=n,this.dataPromise=r,this.options={width:320,height:200,padding_hor:5,padding_ver:5,radius:5,callback:function(t){return t},callbackThisArg:null,triggerCallback:"change"},a.merge(this.options,i),this.scale_=e.clone(),this.build(o.select(t))}return Object.defineProperty(t.prototype,"scale",{get:function(){return this.scale_},enumerable:!0,configurable:!0}),t.prototype.build=function(t){function e(){m.attr({x1:function(t){return g(p.scale.apply(t))},x2:f}).style("visibility",function(t){var e=p.scale.domain;return t<e[0]||t>e[e.length-1]?"hidden":null})}function n(t){return o.behavior.drag().on("dragstart",function(){o.select(this).classed("dragging",!0).attr("r",1.1*u.radius)}).on("drag",t).on("dragend",function(){o.select(this).classed("dragging",!1).attr("r",u.radius),l(!0)})}function i(){function a(){y.sort(function(t,e){return t.r-e.r});var t=p.scale;t.domain=y.map(function(t){return t.r}),t.range=y.map(function(t){return t.n}),e()}function l(t){y.length<=2||(y.splice(t,1),a(),i())}function c(t){t=r(t,0,d),y.push({n:g.invert(t),r:f.invert(t)}),a(),i()}if(p.scale instanceof s.ScaleMappingFunction){var m=p.scale,v=m.domain,b=m.range;y=v.map(function(t,e){return{r:t,n:b[e]}}),t.selectAll("rect").on("click",function(){c(o.mouse(t.select("svg > g").node())[0])});var C=t.select("g.mappings").selectAll("g.mapping").data(y),k=C.enter().append("g").classed("mapping",!0).on("contextmenu",function(t,e){o.event.preventDefault(),o.event.stopPropagation(),l(e)});k.append("line").attr({y1:0,y2:h}).call(n(function(t){var e=o.event.dx,n=r(g(t.n)+e,0,d),i=r(f(t.r)+e,0,d);t.n=g.invert(n),t.r=f.invert(i),o.select(this).attr("x1",n).attr("x2",i),o.select(this.parentElement).select("circle.normalized").attr("cx",n),o.select(this.parentElement).select("circle.raw").attr("cx",i),a()})),k.append("circle").classed("normalized",!0).attr("r",u.radius).call(n(function(t){var e=r(o.event.x,0,d);t.n=g.invert(e),o.select(this).attr("cx",e),o.select(this.parentElement).select("line").attr("x1",e),a()})),k.append("circle").classed("raw",!0).attr("r",u.radius).attr("cy",h).call(n(function(t){var e=r(o.event.x,0,d);t.r=f.invert(e),o.select(this).attr("cx",e),o.select(this.parentElement).select("line").attr("x2",e),a()})),C.select("line").attr({x1:function(t){return g(t.n)},x2:function(t){return f(t.r)}}),C.select("circle.normalized").attr("cx",function(t){return g(t.n)}),C.select("circle.raw").attr("cx",function(t){return f(t.r)}),C.exit().remove()}}function a(){if(!(p.scale instanceof s.ScriptMappingFunction))return void t.select("div.script").style("display","none");t.select("div.script").style("display",null);var n=p.scale,r=t.select("textarea").text(n.code);t.select("div.script").select("button").on("click",function(){var t=r.property("value");n.code=t,e(),l()})}function l(t){void 0===t&&(t=!1),t&&"dragend"!==u.triggerCallback||u.callback.call(u.callbackThisArg,p.scale.clone())}function c(){var n=f.domain();t.select("input.raw_min").property("value",n[0]),t.select("input.raw_max").property("value",n[1]),e(),i()}var u=this.options,p=this;t=t.append("div").classed("lugui-me",!0),t.node().innerHTML='<div>\n    <span class="raw_min">0</span>\n    <span class="center"><label><select>\n        <option value="linear">Linear</option>\n        <option value="linear_invert">Invert</option>\n        <option value="linear_abs">Absolute</option>\n        <option value="log">Log</option>\n        <option value="pow1.1">Pow 1.1</option>\n        <option value="pow2">Pow 2</option>\n        <option value="pow3">Pow 3</option>\n        <option value="sqrt">Sqrt</option>\n        <option value="script">Custom Script</option>\n      </select></label>\n      </span>\n    <span class="raw_max">1</span>\n  </div>\n  <svg width="'+u.width+'" height="'+u.height+'">\n    <rect width="100%" height="10"></rect>\n    <rect width="100%" height="10" y="'+(u.height-10)+'"></rect>\n    <g transform="translate('+u.padding_hor+","+u.padding_ver+')">\n      <g class="samples">\n\n      </g>\n      <g class="mappings">\n\n      </g>\n    </g>\n  </svg>\n  <div>\n    <input type="text" class="raw_min" value="0">\n    <span class="center">Raw</span>\n    <input type="text" class="raw_max" value="1">\n  </div>\n  <div class="script">\n    <textarea>\n\n    </textarea>\n    <button>Apply</button>\n  </div>';var d=u.width-2*u.padding_hor,h=u.height-2*u.padding_ver,f=o.scale.linear().domain([Math.min(this.scale.domain[0],this.original.domain[0]),Math.max(this.scale.domain[this.scale.domain.length-1],this.original.domain[this.original.domain.length-1])]).range([0,d]),g=o.scale.linear().domain([0,1]).range([0,d]);t.select("input.raw_min").property("value",f.domain()[0]).on("blur",function(){var t=f.domain();t[0]=parseFloat(this.value),f.domain(t);var e=p.scale_.domain;e[0]=t[0],p.scale_.domain=e,c(),l()}),t.select("input.raw_max").property("value",f.domain()[1]).on("blur",function(){var t=f.domain();t[1]=parseFloat(this.value),f.domain(t);var e=p.scale_.domain;e[e.length-1]=t[1],p.scale_.domain=e,c(),l()});var m=t.select("g.samples").selectAll("line").data([]);this.dataPromise.then(function(t){t=o.set(t.map(String)).values().map(parseFloat),m=m.data(t),m.enter().append("line").attr({x1:function(t){return g(p.scale.apply(t))},y1:0,x2:f,y2:h}).style("visibility",function(t){var e=p.scale.domain;return t<e[0]||t>e[e.length-1]?"hidden":null})});var y=[];i(),a(),c(),t.select("select").on("change",function(){var t=this.value;if("linear_invert"===t)p.scale_=new s.ScaleMappingFunction(f.domain(),"linear",[1,0]);else if("linear_abs"===t){var n=f.domain();p.scale_=new s.ScaleMappingFunction([n[0],(n[1]-n[0])/2,n[1]],"linear",[1,0,1])}else"script"===t?p.scale_=new s.ScriptMappingFunction(f.domain()):p.scale_=new s.ScaleMappingFunction(f.domain(),t);e(),i(),a(),l()}).property("selectedIndex",function(){var t="script";p.scale_ instanceof s.ScaleMappingFunction&&(t=p.scale.scaleType);var e=["linear","linear_invert","linear_abs","log","pow1.1","pow2","pow3","sqrt","script"];return e.indexOf(t)})},t}();e.MappingEditor=l,e.create=i}])});